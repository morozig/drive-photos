{"version":3,"sources":["lib/api.ts","containers/home/components/topbar/index.tsx","containers/home/components/landing/speech-bubble/speech-bubble.svg","containers/home/components/landing/speech-bubble/speech-bubble-wide.svg","containers/home/components/landing/speech-bubble/index.tsx","containers/home/components/landing/comix/index.tsx","lib/observable.ts","lib/screenfull.ts","containers/view/index.tsx","lib/hooks.ts","containers/view/components/thumbnails/hooks.ts","containers/home/components/landing/space/helpers.ts","containers/home/components/landing/space/index.tsx","containers/home/components/landing/index.tsx","containers/home/components/landing/hooks.ts","containers/home/index.tsx","containers/view/components/thumbnails/Thumbnail.tsx","containers/view/components/thumbnails/VirtualGrid.tsx","containers/view/components/thumbnails/index.tsx","containers/view/components/viewer/hooks.ts","containers/view/components/zoom-slider/index.tsx","containers/view/components/image-skeleton/index.tsx","containers/view/components/image-screen/index.tsx","containers/view/components/viewer/index.tsx","containers/view/components/topbar/GoogleIcon.tsx","containers/view/components/topbar/TitleTooltip.tsx","containers/view/components/topbar/index.tsx","containers/view/components/start-screen/index.tsx","App.tsx","theme.ts","index.tsx"],"names":["GoogleAuth","picker","checkScopesPromise","DirectoryEdge","Topbar","useState","isMenuOpen","setMenuOpen","menuRef","useRef","isHelpMenuOpen","setHelpMenuOpen","helpMenuRef","handleMenuClose","useCallback","handleMenuClick","current","handleHelpMenuClose","handleHelpMenuClick","Toolbar","IconButton","size","edge","color","sx","mr","ref","onClick","Menu","anchorEl","open","onClose","disableScrollLock","MenuItem","component","Link","to","ListItemIcon","ListItemText","Box","flexGrow","overflow","Typography","variant","noWrap","textOverflow","Tooltip","title","p","xs","md","MenuListProps","href","process","SpeechBubble","props","background","speechBubble","speechBubbleWide","backgroundPosition","backgroundSize","backgroundRepeat","textAlign","fontFamily","padding","maxWidth","marginRight","fontSize","lineHeight","children","OpenView","Button","RouterLink","startIcon","slides","Paper","height","width","position","backgroundColor","border","boxSizing","src","bottom","left","maxHeight","undefined","top","right","marginTop","display","flexDirection","justifyContent","alignContent","justifySelf","margin","underline","marginLeft","Comix","jumpHeight","map","slide","i","length","Observable","observers","observer","this","push","subscribe","onceObserver","message","unsubscribe","splice","indexOf","forEach","driveInfoScope","driveFileScope","scope","join","discoveryDocs","apiKey","signedInObservable","gapiErrorsObservable","gapiReadyObservable","pickerCreatedTime","pickObservable","gapiError","sleep","ms","Promise","resolve","setTimeout","onSignedInChanged","isSignedIn","onPick","onGapiLoaded","a","gapi","client","init","clientId","auth2","getAuthInstance","get","listen","console","log","checkScopes","reject","user","currentUser","getAuthResponse","hasInfoScope","includes","hasFileScope","options","SigninOptionsBuilder","setScope","concat","grant","then","Error","err","catch","response","createPicker","accessToken","access_token","now","Date","getTime","view","google","DocsView","ViewId","DOCS_IMAGES","setMimeTypes","setIncludeFolders","setParent","PickerBuilder","addView","enableFeature","Feature","NAV_HIDDEN","setOAuthToken","setDeveloperKey","setCallback","build","checkPickerTimeout","setVisible","dispose","unsubscribeAll","pickFile","onThisPick","action","doc","docs","getFile","fileId","drive","files","fields","result","listFiles","parentId","pageToken","list","q","pageSize","orderBy","getEdgeFiles","Begin","getParent","listDirectories","grandParentId","load","FitMode","document","window","fn","val","fnMap","l","ret","Screenfull","Boolean","fullscreenElement","event","callback","eventName","fullscreenerror","fullscreenchange","addEventListener","removeEventListener","element","onFullScreenEntered","off","on","returnPromise","documentElement","requestFullscreen","isFullscreen","onFullScreenExit","exitFullscreen","exit","request","fullscreenEnabled","recentLocalStorageKey","useAbortSignal","abortControllerRef","AbortController","useEffect","abortController","abort","signal","useIsSignedIn","onSignOut","signedIn","setSignedIn","profile","setProfile","setGapiError","isCookiesError","setCookiesError","onChange","onError","toggleSignedIn","signOut","signIn","once","imageUrl","getBasicProfile","getImageUrl","details","useFullScreen","setFullscreen","isEnabled","run","toggleFullScreen","div","toggle","useEdgeFile","parent","file","setFile","parentIdRef","id","edgeFiles","aborted","useDrive","setFiles","setPageToken","isFinished","setFinished","isCleared","setCleared","prevFiles","nextPageToken","clear","useMemo","find","other","useFiles","directory","setDirectory","useDirectory","directories","setDirectories","cacheIdRef","cacheDirectoriesRef","prevDirectories","slice","useDirectories","setGrandParentId","parents","useGrandParentId","directoryIndex","findIndex","sibling","prevDirectory","nextDirectory","prevDirFile","End","nextDirFile","lastClearedTimeRef","onImageError","useIsTouchScreen","useMediaQuery","useDebounce","value","delay","debouncedValue","setDebouncedValue","timeout","clearTimeout","useRectSize","rectSize","setRectSize","debouncedRectSize","check","requestAnimationFrame","offsetWidth","offsetHeight","easeInOutSine","time","timeFrom","timeTo","valFrom","valTo","Math","cos","PI","Space","slideHeight","scrollTop","isJumping","setJumping","cellSize","randomShift","random","slidesWithCoordinates","hash","Map","row","column","floor","key","slideWithCoordinates","shift","set","cells","numRows","j","dx","dy","dz","transform","loading","planeShift","scrollMax","slideIndex","scroll","scrollJump","curr","prev","next","prevX","prevY","prevZ","nextX","nextY","nextZ","timeCapFraction","valCap","timeCap","easeInOutCap","calculateShift","debouncedSrollTop","perspective","willChange","transformStyle","transition","Landing","setScrollTop","onScroll","useScrollAware","isTouchScreen","round","clientHeight","zIndex","visibility","Home","AppBar","theme","drawer","itemToKey","item","counter","ThumbnailInner","isActive","subVisiblePart","onMoveVisible","visiblePart","setVisiblePart","isGrabbing","setGrabbing","onVisiblePartChanged","widthPart","heightPart","imageMediaMetadata","onMouseDown","onMouseMove","e","movementX","max","min","movementY","onMouseUp","borderRadius","bgcolor","cursor","thumbnailLink","alt","name","clipPath","ImageListItemBar","subtitle","Thumbnail","React","memo","prevProps","nextProps","VirtualGridInner","virtualGridRef","items","itemHeight","itemWidth","ItemElement","activeIndex","onActive","scrollToIndex","onVisibleRows","numColumns","center","itemsCount","itemsInRow","rowsCount","ceil","isScrolling","setScrolling","isScrollingHandlerRef","setIsScrolling","scrollContainer","target","useScroll","totalHeight","startRow","startItem","visibleItemsCount","offsetY","firstVisibleRow","lastVisibleRow","visibleRows","visibleItems","gridTemplateColumns","doScrollToIndex","block","scrollToRow","scrollOffset","scrollToRowTop","scrollToRowBottom","scrollBottom","scrollTo","useImperativeHandle","index","overflowY","pointerEvents","gap","justifyItems","VirtualGrid","forwardRef","Thumbnails","onSelect","onVisibleFiles","scrollIndexRef","sliderScale","sliderValue","useZoom","setSliderValue","onSliderChange","Array","isArray","onZoomMinus","onZoomPlus","zoom","setZoom","setter","currentValue","currentZoom","newValue","zoomToValue","ZoomSlider","Stack","spacing","direction","alignItems","Slider","step","valueLabelDisplay","scale","pulseKeyframe","keyframes","ImageSkeleton","xmlns","viewBox","animation","ImageScreen","imageScreenRef","containerRectSize","fitMode","isSlideshowPlaying","isScrollDisabled","onPrevImage","onNextImage","isPreload","onOverflowChanged","onVisibleChange","localZoom","setLocalZoom","modeZoomRef","scrollbarWidth","setWidth","outer","createElement","style","body","appendChild","inner","parentNode","removeChild","useBrowserScrollbarWidth","isOferflowRef","isDisabled","wheelCount","onScrollOverTop","onScrollBelowBottom","isOverflow","scrollTopRef","scrollOverTopCountRef","scrollBelowBottomCountRef","scrollNextSlide","scrollHeight","slideSize","onWheel","shiftKey","ctrlKey","deltaY","useScrollActions","timer","setInterval","clearInterval","imageWidth","imageHeight","Best","horizontalScale","verticalScale","Width","Height","Original","Manual","isHorizontalScroll","clientWidth","fixedPointRef","preventDefault","zoomSetter","minLocalZoom","maxLocalZoom","Infinity","newLocalZoom","offsetX","scrollX","scrollLeft","scrollY","saveFixedPoint","fixedPoint","touchesRef","diffRef","onPointerDown","onPointerMove","pointerId","newDiff","sqrt","pow","clientX","clientY","scrollToFixedPoint","onPointerUp","updateVisible","scrollWidth","scrollVisibleTo","whiteSpace","touchAction","webContentLink","Viewer","viewerRef","canPrev","prevFile","canNext","nextFile","preloadFiles","onFitModeChange","isScrollToBottom","isSlideshowEnabled","onToggleSlideshowPlaying","contextMenu","setContextMenu","containerRef","setOverflow","scrollContainerRef","currentImageScreenRef","contentHash","isSwipeLockedRef","useTouchScroll","toggleFullscreen","onContextMenu","x","y","onClickFullscreen","onClickFitBest","onClickFitWidth","onClickFitHeight","onClickFitOriginal","onClickFitManual","onClickSlideshow","prevDebounced","nextDebounced","fitModeDebounced","zoomDebounced","overflowX","scrollSnapType","flex","scrollSnapAlign","container","anchorReference","anchorPosition","GoogleIcon","SvgIcon","fill","d","TitleTooltip","text","disableHoverListener","counterTitle","onOpenFile","onRecentFile","fullscreenButtonActive","onToggleFullscreen","isFirstImageEnabled","isPrevImageEnabled","isNextImageEnabled","isLastImageEnabled","onFirstImage","onLastImage","recentFiles","onDownloadFile","onCloseFile","isMobileDrawerOpen","toggleMobileDrawer","isRecentMenuOpen","setRecentMenuOpen","recentMenuRef","isProfileMenuOpen","setProfileMenuOpen","profileMenuRef","isFullscreenEnabled","onOpenClick","onDrawerClick","onDownloadClick","onCloseClick","handleRecentMenuClose","handleRecentMenuClick","onRecentFileClick","recentFile","handleProfileMenuClose","handleProfileMenuClick","onSignOutClick","disabled","Divider","defaultTitle","PaperProps","anchorOrigin","vertical","horizontal","m","ToggleButtonGroup","exclusive","sm","ToggleButton","Avatar","ml","StartScreen","textTransform","drawerWidth","View","setFitMode","setParentId","setFileId","setIsScrollToBottom","setTitle","setSlideshowPlaying","visibleThumbnails","setVisibleThumbnails","setMobileDrawerOpen","isSmallScreen","useTheme","breakpoints","down","useIsSmallScreen","setRecentFiles","recentJsonRef","recentJson","localStorage","getItem","JSON","parse","replace","recentLength","remove","filter","stringify","setItem","removeItem","useRecentFiles","fileJustOpenedRef","activeFile","fileName","documentTitle","newIndex","wasSlideshowPlayingRef","url","download","click","Set","add","delete","from","onKeyDown","visiblePartObservable","cb","pubVisiblePart","SwipeableDrawer","anchor","onOpen","flexShrink","ModalProps","keepMounted","Drawer","App","path","createTheme","palette","primary","main","contrastText","secondary","components","MuiTooltip","styleOverrides","tooltip","ReactDOM","render","ThemeProvider","StrictMode","CssBaseline","getElementById"],"mappings":"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","file":"static/js/main.c4a9b78e.chunk.js","sourcesContent":["import Observable from './observable';\r\nimport './Picker.css';\r\n\r\nconst driveInfoScope = 'https://www.googleapis.com/auth/drive.metadata.readonly';\r\nconst driveFileScope = 'https://www.googleapis.com/auth/drive.readonly';\r\nconst scope = [\r\n  driveInfoScope,\r\n  driveFileScope\r\n].join(' ');\r\nconst discoveryDocs = [\r\n  'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'\r\n];\r\nconst apiKey = process.env.NODE_ENV === 'production' ?\r\n  'AIzaSyDAXtOKqc3gYjmuoxZAqQHnBm-xTQi1-Mw' :\r\n    process.env.REACT_APP_GAPI_KEY;\r\nconst clientId = '321539141956-kn4i96a10682t0l8agfo5158fln9ai5d.apps.googleusercontent.com';\r\nconst pickerTimeout = 24 * 60 * 1000;\r\n// const pickerTimeout = 0.5 * 60 * 1000;\r\n\r\nconst signedInObservable = new Observable<boolean>();\r\nconst gapiErrorsObservable = new Observable<any>();\r\nlet GoogleAuth: gapi.auth2.GoogleAuth | undefined;\r\nconst gapiReadyObservable = new Observable<void>();\r\nlet picker: google.picker.Picker | undefined;\r\nlet pickerCreatedTime = 0;\r\nconst pickObservable = new Observable<google.picker.ResponseObject>();\r\nlet gapiError = null as null | any;\r\n\r\nexport interface Profile {\r\n  imageUrl: string;\r\n}\r\n\r\nconst sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\r\n\r\nconst onSignedInChanged = (isSignedIn: boolean) => {\r\n  // console.log('onSignedInChanged', isSignedIn);\r\n  signedInObservable.push(isSignedIn);\r\n  if (!isSignedIn) {\r\n    picker = undefined;\r\n    pickObservable.unsubscribe(onPick);\r\n  }\r\n};\r\n\r\nconst onGapiLoaded = async () => {\r\n  try {\r\n    await gapi.client.init({\r\n      apiKey,\r\n      clientId,\r\n      scope,\r\n      discoveryDocs\r\n    });\r\n    GoogleAuth = gapi.auth2.getAuthInstance();\r\n    // console.log(gapi.auth2, GoogleAuth, GoogleAuth.isSignedIn, google);\r\n    onSignedInChanged(GoogleAuth.isSignedIn.get());\r\n    GoogleAuth.isSignedIn.listen(onSignedInChanged);\r\n    gapiReadyObservable.push();\r\n  }\r\n  catch (err) {\r\n    console.log(err);\r\n    gapiErrorsObservable.push(err);\r\n    gapiError = err;\r\n  }\r\n};\r\n\r\nlet checkScopesPromise: Promise<void> | undefined;\r\n\r\nconst checkScopes = () => new Promise<void>((resolve, reject) => {\r\n  if (!GoogleAuth) {\r\n    reject(new Error('not authed'));\r\n    return;\r\n  }\r\n  const user = GoogleAuth.currentUser.get();\r\n  const authResponse = user.getAuthResponse(true);\r\n  const scope = authResponse.scope;\r\n  const hasInfoScope = scope.includes(driveInfoScope);\r\n  const hasFileScope = scope.includes(driveFileScope);\r\n  if (hasInfoScope && hasFileScope) {\r\n    resolve();\r\n    return;\r\n  }\r\n  if (!checkScopesPromise) {\r\n    checkScopesPromise = new Promise<void>((resolve, reject) => {\r\n      const options = new gapi.auth2.SigninOptionsBuilder();\r\n      options.setScope(''.concat(\r\n        !hasInfoScope ? `${driveInfoScope} ` : ' ',\r\n        !hasFileScope ? `${driveFileScope} ` : ' ',\r\n      ));\r\n      user.grant(options).then(\r\n        () => {\r\n          checkScopesPromise = undefined;\r\n          // console.log('checkScopes granted');\r\n          const authResponse = user.getAuthResponse(true);\r\n          const scope = authResponse.scope;\r\n          const hasInfoScope = scope.includes(driveInfoScope);\r\n          const hasFileScope = scope.includes(driveFileScope);\r\n          if (hasInfoScope && hasFileScope) {\r\n            resolve();\r\n            return;\r\n          } else {\r\n            reject(new Error('access not granted'));\r\n          }\r\n        },\r\n        (err) => {\r\n          checkScopesPromise = undefined;\r\n          // console.log('checkScopes rejected');\r\n          reject(err);\r\n        }\r\n      );\r\n    });\r\n  }\r\n  checkScopesPromise\r\n    .then(resolve)\r\n    .catch(reject);\r\n});\r\n\r\nconst onPick = (response: google.picker.ResponseObject) => {\r\n  // console.log('onPick', response);\r\n  pickObservable.push(response);\r\n};\r\n\r\nconst createPicker = () => {\r\n  if (!GoogleAuth) {\r\n    throw new Error('not authed');\r\n  }\r\n  if (!apiKey) {\r\n    throw new Error('set gapi key');\r\n  }\r\n  const user = GoogleAuth.currentUser.get();\r\n  const authResponse = user.getAuthResponse(true);\r\n  const accessToken = authResponse.access_token;\r\n  const now = new Date().getTime();\r\n  pickerCreatedTime = now;\r\n\r\n  const view = new google.picker.DocsView(google.picker.ViewId.DOCS_IMAGES)\r\n    .setMimeTypes('image/apng,image/avif,image/gif,image/jpeg,image/png,image/svg+xml,image/webp')\r\n    .setIncludeFolders(true)\r\n    .setParent('root');\r\n  \r\n  picker = new google.picker.PickerBuilder()\r\n    .addView(view)\r\n    .enableFeature(google.picker.Feature.NAV_HIDDEN)\r\n    .setOAuthToken(accessToken)\r\n    .setDeveloperKey(apiKey)\r\n    .setCallback(onPick)\r\n    .build();\r\n  // console.log({picker});\r\n\r\n};\r\n\r\nconst checkPickerTimeout = async () => {\r\n  if (picker) {\r\n    const now = new Date().getTime();\r\n    const diff = now - pickerCreatedTime;\r\n    const isTimedOut = diff > pickerTimeout;\r\n    if (isTimedOut) {\r\n      picker.setVisible(false);\r\n      picker.dispose();\r\n      pickObservable.unsubscribeAll();\r\n      await sleep (100);\r\n      picker = undefined;\r\n      createPicker();\r\n    }\r\n  } else {\r\n    createPicker();\r\n  }\r\n};\r\n\r\n// console.log(gapi);\r\n\r\nconst isSignedIn = () => {\r\n  return !!GoogleAuth &&\r\n    GoogleAuth.isSignedIn.get() as boolean;\r\n};\r\nexport type SignedInChangeHandler = (isSignedIn: boolean) => void;\r\n\r\nconst subscribeToSignedInChange = (onChange: SignedInChangeHandler) => {\r\n  signedInObservable.subscribe(onChange);\r\n  return () => signedInObservable.unsubscribe(onChange);\r\n};\r\n\r\nconst signIn = () => {\r\n  if (GoogleAuth) {\r\n    GoogleAuth.signIn();\r\n  } else {\r\n    gapiReadyObservable.once(\r\n      () => {\r\n        if (GoogleAuth) {\r\n          GoogleAuth.signIn();\r\n        }\r\n      }\r\n    );\r\n  }\r\n};\r\nconst signOut = () => {\r\n  if (GoogleAuth) {\r\n    GoogleAuth.signOut();\r\n  }\r\n};\r\nconst pickFile = () => new Promise<google.picker.DocumentObject | null>(\r\n  (resolve, reject) => {\r\n    const onThisPick = (response: google.picker.ResponseObject) => {\r\n      if (response.action === 'picked') {\r\n        const doc = response.docs[0];\r\n        pickObservable.unsubscribe(onThisPick);\r\n        resolve(doc);\r\n      } else if (response.action === 'cancel') {\r\n        pickObservable.unsubscribe(onThisPick);\r\n        resolve(null);\r\n      }\r\n    };\r\n\r\n    // console.log('started pick', new Date().getTime());\r\n\r\n    checkScopes()\r\n      .then(checkPickerTimeout)\r\n      .then(() => {\r\n        if (picker) {\r\n          picker.setVisible(true);\r\n        } else {\r\n          reject(new Error('No Picker'));\r\n        }\r\n    \r\n        pickObservable.subscribe(onThisPick);\r\n      })\r\n      .catch(reject);\r\n  }\r\n);\r\n\r\nconst getFile = async (fileId: string) => {\r\n  await checkScopes();\r\n  const result = await gapi.client.drive.files.get({\r\n    fileId,\r\n    // fields: '*'\r\n    fields: 'id, name, thumbnailLink, webContentLink, imageMediaMetadata/*',\r\n  });\r\n  return result.result;\r\n};\r\n\r\nexport interface ListFilesOptions {\r\n  parentId: string;\r\n  pageToken?: string;\r\n};\r\n\r\nconst listFiles = async (options: ListFilesOptions) => {\r\n  const {\r\n    parentId,\r\n    pageToken\r\n  } = options;\r\n  await checkScopes();\r\n  const result = await gapi.client.drive.files.list({\r\n    q: `'${parentId}' in parents and mimeType contains 'image/'`,\r\n    fields: 'nextPageToken, files(id, name, thumbnailLink, webContentLink, imageMediaMetadata/*)',\r\n    // fields: '*',\r\n    pageSize: 1000,\r\n    orderBy: 'name_natural',\r\n    pageToken\r\n  });\r\n  // console.log({result});\r\n  return result.result;\r\n};\r\n\r\nexport enum DirectoryEdge {\r\n  Begin = 1,\r\n  End\r\n};\r\ninterface GetEdgeFileOptions {\r\n  parentId: string;\r\n  edge: DirectoryEdge;\r\n};\r\n\r\nconst getEdgeFiles = async (options: GetEdgeFileOptions) => {\r\n  const {\r\n    parentId,\r\n    edge\r\n  } = options;\r\n  await checkScopes();\r\n  const result = await gapi.client.drive.files.list({\r\n    q: `'${parentId}' in parents and mimeType contains 'image/'`,\r\n    fields: 'files(id, name)',\r\n    pageSize: 1,\r\n    orderBy: edge === DirectoryEdge.Begin ?\r\n      'name_natural' : 'name_natural desc'\r\n  });\r\n  return (\r\n    result.result && result.result.files ?\r\n      result.result.files : []\r\n  );\r\n};\r\n\r\nconst getParent = async (parentId: string) => {\r\n  await checkScopes();\r\n  const result = await gapi.client.drive.files.get({\r\n    fileId: parentId,\r\n    fields: '*'\r\n  });\r\n  return result.result;\r\n};\r\n\r\nexport interface ListDirectoriesOptions {\r\n  grandParentId: string;\r\n  pageToken?: string;\r\n};\r\n\r\nconst listDirectories = async (options: ListDirectoriesOptions) => {\r\n  const {\r\n    grandParentId,\r\n    pageToken,\r\n  } = options;\r\n  await checkScopes();\r\n  const result = await gapi.client.drive.files.list({\r\n    q: `'${grandParentId}' in parents and mimeType = 'application/vnd.google-apps.folder'`,\r\n    fields: 'nextPageToken, files(id, name)',\r\n    // fields: '*',\r\n    pageSize: 1000,\r\n    orderBy: 'name_natural',\r\n    pageToken,\r\n  });\r\n  // console.log({result});\r\n  return result.result;\r\n};\r\n\r\nconst getProfile = () => {\r\n  if (!GoogleAuth) {\r\n    return null;\r\n  }\r\n  const user = GoogleAuth.currentUser.get();\r\n  const profile = user.getBasicProfile();\r\n  const imageUrl = profile.getImageUrl();\r\n  return {\r\n    imageUrl\r\n  } as Profile;\r\n};\r\n\r\nexport type GapiErrorHandler = (error: any) => void;\r\nconst subscribeToGapiErrors = (onError: GapiErrorHandler) => {\r\n  gapiErrorsObservable.subscribe(onError);\r\n  return () => gapiErrorsObservable.unsubscribe(onError);\r\n};\r\nconst getGapiError = () => gapiError;\r\n\r\ngapi.load('client:auth2:picker', onGapiLoaded);\r\n\r\nexport {\r\n  isSignedIn,\r\n  signIn,\r\n  signOut,\r\n  subscribeToSignedInChange,\r\n  pickFile,\r\n  getFile,\r\n  listFiles,\r\n  getParent,\r\n  getEdgeFiles,\r\n  listDirectories,\r\n  getProfile,\r\n  subscribeToGapiErrors,\r\n  getGapiError\r\n};\r\n","import React, {\r\n  useState,\r\n  useRef,\r\n  useCallback,\r\n} from 'react';\r\nimport {\r\n  Box,\r\n  Toolbar,\r\n  Typography,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  Tooltip,\r\n  ListItemIcon,\r\n  ListItemText\r\n} from '@material-ui/core';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport HelpIcon from '@material-ui/icons/HelpOutline';\r\nimport AboutIcon from '@material-ui/icons/Info';\r\nimport PolicyIcon from '@material-ui/icons/Policy';\r\nimport TermsIcon from '@material-ui/icons/Gavel';\r\nimport { Link } from 'react-router-dom';\r\nimport OpenViewIcon from '@material-ui/icons/OpenInBrowser';\r\n\r\nconst Topbar: React.FC = () => {\r\n  const [ isMenuOpen, setMenuOpen ] = useState(false);\r\n  const menuRef = useRef<HTMLButtonElement>(null);\r\n  const [ isHelpMenuOpen, setHelpMenuOpen ] = useState(false);\r\n  const helpMenuRef = useRef<HTMLButtonElement>(null);\r\n\r\n  const handleMenuClose = useCallback(() => {\r\n    setMenuOpen(false);\r\n  }, []);\r\n  const handleMenuClick = useCallback(() => {\r\n    setMenuOpen(current => !current);\r\n  }, []);\r\n  const handleHelpMenuClose = useCallback(() => {\r\n    setHelpMenuOpen(false);\r\n  }, []);\r\n  const handleHelpMenuClick = useCallback(() => {\r\n    setHelpMenuOpen(current => !current);\r\n  }, []);\r\n\r\n  return (\r\n    <Toolbar>\r\n      <IconButton\r\n        size='large'\r\n        edge='start'\r\n        color='inherit'\r\n        aria-label='menu'\r\n        sx={{ mr: 2 }}\r\n        ref={menuRef}\r\n        onClick={handleMenuClick}\r\n      >\r\n        <MenuIcon />\r\n      </IconButton>\r\n      <Menu\r\n        anchorEl={menuRef.current}\r\n        open={isMenuOpen}\r\n        onClose={handleMenuClose}\r\n        disableScrollLock={true}\r\n      >\r\n        <MenuItem\r\n          component={Link}\r\n          to={'/view'}\r\n        >\r\n          <ListItemIcon>\r\n            <OpenViewIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Open View'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n      <Box\r\n        sx={{\r\n          flexGrow: 1,\r\n          overflow: 'hidden'\r\n        }}\r\n      >\r\n        <Typography\r\n          variant='h6'\r\n          noWrap\r\n          sx={{\r\n            textOverflow: 'ellipsis'\r\n          }}\r\n        >\r\n          {'Drive Photos'}\r\n        </Typography>\r\n      </Box>\r\n      <Tooltip\r\n        title='Terms And Conditions'\r\n      >\r\n        <IconButton\r\n          size='large'\r\n          color='inherit'\r\n          aria-label='terms-and-policy'\r\n          edge={'end'}\r\n          ref={helpMenuRef}\r\n          onClick={handleHelpMenuClick}\r\n          sx={{\r\n            p: { xs: '6px', md: '12px'}\r\n          }}\r\n        >\r\n          <HelpIcon/>\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Menu\r\n        anchorEl={helpMenuRef.current}\r\n        open={isHelpMenuOpen}\r\n        onClose={handleHelpMenuClose}\r\n        MenuListProps={{\r\n          'aria-labelledby': 'basic-button',\r\n        }}\r\n        disableScrollLock={true}\r\n      >\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/about.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <AboutIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'About'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/privacy.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <PolicyIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Privacy Policy'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/terms.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <TermsIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Terms And Conditions'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n    </Toolbar>\r\n  );\r\n};\r\n\r\nexport default Topbar;\r\n","export default __webpack_public_path__ + \"static/media/speech-bubble.52063f50.svg\";","export default __webpack_public_path__ + \"static/media/speech-bubble-wide.07d56428.svg\";","import React, {\r\n} from 'react';\r\nimport {\r\n  Typography,\r\n  Box\r\n} from '@material-ui/core';\r\nimport './ComicFont.css';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system';\r\nimport speechBubble from './speech-bubble.svg';\r\nimport speechBubbleWide from './speech-bubble-wide.svg';\r\n\r\ninterface SpeechBubbleProps {\r\n  sx?: SystemStyleObject;\r\n}\r\n\r\nconst SpeechBubble: React.FC<SpeechBubbleProps> = (props) => {\r\n  const {\r\n    sx\r\n  } = props;\r\n  return (\r\n    <Box\r\n      sx={{\r\n        ...sx,\r\n        background: {\r\n          xs: `url(${speechBubble})`,\r\n          md: `url(${speechBubbleWide})`,\r\n        },\r\n        backgroundPosition: 'center',\r\n        backgroundSize: '100% 100%',\r\n        backgroundRepeat: 'no-repeat',\r\n        textAlign: 'center',\r\n        fontFamily: 'Comic Sans MS',\r\n        padding: {\r\n          xs: '10vmin 5vmin 30vmin 5vmin',\r\n          md: '15vmin 15vmin 15vmin 15vmin',\r\n        },\r\n        maxWidth: {\r\n          xs: '60vmin',\r\n          md: '100vmin',\r\n        },\r\n        marginRight: {\r\n          xs: '0',\r\n          md: '-5vmin',\r\n        },\r\n      }}\r\n    >\r\n      {/* {props.children} */}\r\n      <Typography\r\n        fontFamily={'Comic Sans MS'}\r\n        fontSize={'7vmin'}\r\n        lineHeight={'7vmin'}\r\n      >\r\n        {props.children}\r\n      </Typography>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default SpeechBubble;\r\n","import React, { Fragment } from 'react';\r\nimport {\r\n  Box,\r\n  Link,\r\n  Paper,\r\n  Toolbar,\r\n  Button\r\n} from '@material-ui/core';\r\nimport SpeechBubble from '../speech-bubble';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport OpenViewIcon from '@material-ui/icons/OpenInBrowser';\r\n\r\ninterface ComixProps {\r\n  jumpHeight: number;\r\n  sx?: SystemStyleObject;\r\n}\r\n\r\nconst OpenView: React.FC = () => {\r\n  return (\r\n    <Button\r\n      component={RouterLink}\r\n      to={'/view'}\r\n      variant={'contained'}\r\n      color='secondary'\r\n      startIcon={<OpenViewIcon/>}\r\n    >\r\n      {'Open View'}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport const slides = [\r\n  <Paper>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#6df3db',\r\n        border: 'solid black 0.8vmin',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl1.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0,\r\n        }}\r\n      >\r\n        {'Drive Photos'}\r\n      </SpeechBubble>\r\n    </Box>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#ffdc2e',\r\n        border: 'solid black 0.8vmin',\r\n        marginTop: '3vh',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl2.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'Online image viewer for Google Drive.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n  </Paper>,\r\n  <Paper>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#f31872',\r\n        border: 'solid black 0.8vmin',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl3.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'Access your photos anywhere.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#02c7fc',\r\n        border: 'solid black 0.8vmin',\r\n        marginTop: '3vh',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl4.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'All devices are supported.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n  </Paper>,\r\n  <Paper>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#fe0000',\r\n        border: 'solid black 0.8vmin',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl5.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'Free and open source.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#fe3989',\r\n        border: 'solid black 0.8vmin',\r\n        marginTop: '3vh',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl6.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'No server, all personal data stays in your browser.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n  </Paper>,\r\n  <Paper>\r\n    <Box\r\n      sx={{\r\n        height: '100vh',\r\n        width: '100%',\r\n        position: 'relative',\r\n        backgroundColor: '#db0285',\r\n        border: 'solid black 0.8vmin',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden'\r\n      }}\r\n    >\r\n      <Box\r\n        component='img'\r\n        src={`${process.env.PUBLIC_URL}/assets/girl7.jpg`}\r\n        sx={{\r\n          position: 'absolute',\r\n          bottom: 0,\r\n          left: {\r\n            xs: '-5%',\r\n            md: '0',\r\n          },\r\n          maxHeight: {\r\n            xs: '60vh',\r\n            md: '100%',\r\n          },\r\n          maxWidth: {\r\n            xs: undefined,\r\n            md: '70vw',\r\n          },\r\n        }}\r\n      />\r\n      <SpeechBubble\r\n        sx={{\r\n          position: 'absolute',\r\n          top: {\r\n            xs: '10%',\r\n            md: '0',\r\n          },\r\n          right: 0\r\n        }}\r\n      >\r\n        {'Fullscreen and slideshow modes.'}\r\n      </SpeechBubble>\r\n    </Box>\r\n    <Box\r\n      sx={{\r\n        height: '103vh',\r\n        width: '100%',\r\n        backgroundColor: 'white',\r\n        display: 'flex',\r\n        flexDirection: 'column'\r\n      }}\r\n    >\r\n      <Box\r\n        sx={{\r\n          flexGrow: 1,\r\n          display: 'grid',\r\n          justifyContent: 'center',\r\n          alignContent: 'center'\r\n        }}\r\n      >\r\n        <Box\r\n          component={'img'}\r\n          src={`${process.env.PUBLIC_URL}/assets/Logo_48.svg`}\r\n          sx={{\r\n            height: '48px',\r\n            width: '48px',\r\n            justifySelf: 'center',\r\n            margin: '0 0 24px 0'\r\n          }}\r\n        />\r\n        <OpenView/>\r\n      </Box>\r\n      <Toolbar\r\n        sx={{\r\n          backgroundColor: '#424242',\r\n          color: 'white',\r\n        }}\r\n      >\r\n        <Link\r\n          href={`${process.env.PUBLIC_URL}/about.html`}\r\n          color='inherit'\r\n          underline='none'\r\n        >\r\n          {'About'}\r\n        </Link>\r\n        <Link\r\n          href={`${process.env.PUBLIC_URL}/privacy.html`}\r\n          color='inherit'\r\n          underline='none'\r\n          sx={{\r\n            marginLeft: '24px'\r\n          }}\r\n        >\r\n          {'Privacy Policy'}\r\n        </Link>\r\n        <Link\r\n          href={`${process.env.PUBLIC_URL}/terms.html`}\r\n          color='inherit'\r\n          underline='none'\r\n          sx={{\r\n            marginLeft: '24px'\r\n          }}\r\n        >\r\n          {'Terms And Conditions'}\r\n        </Link>\r\n      </Toolbar>\r\n    </Box>\r\n  </Paper>\r\n];\r\n\r\nconst Comix: React.FC<ComixProps> = (props) => {\r\n  const {\r\n    jumpHeight,\r\n    sx\r\n  } = props;\r\n  return (\r\n    <Box\r\n      sx={{\r\n        ...sx,\r\n        backgroundColor: 'black'\r\n      }}\r\n    >\r\n      {slides.map((slide, i) => (\r\n        <Fragment key={i}>\r\n          {slide}\r\n          {i < slides.length - 1 ?\r\n            <Box\r\n              sx={{\r\n                height: `${jumpHeight}px`\r\n              }}\r\n            /> : null\r\n          }\r\n        </Fragment>\r\n      ))}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Comix;\r\n","type Observer<T> = (message: T) => void;\r\n\r\nexport default class Observable<T> {\r\n  private observers = [] as Observer<T>[];\r\n  subscribe(observer: Observer<T>) {\r\n    this.observers.push(observer);\r\n  }\r\n  once(observer: Observer<T>) {\r\n    const onceObserver = (message: T) => {\r\n      observer(message);\r\n      this.unsubscribe(onceObserver);\r\n    };\r\n    this.subscribe(onceObserver);\r\n  }\r\n  unsubscribe(observer: Observer<T>){\r\n    this.observers.splice(\r\n      this.observers.indexOf(observer),\r\n      1\r\n    );\r\n  }\r\n  push(message: T) {\r\n    this.observers.forEach(observer => observer(message));\r\n  }\r\n  unsubscribeAll() {\r\n    this.observers = [];\r\n  }\r\n};","const document = typeof window !== 'undefined' &&\r\n\ttypeof window.document !== 'undefined' ?\r\n\t\twindow.document : {} as any;\r\n\r\nconst fn = (() => {\r\n\tlet val;\r\n\r\n\tlet fnMap = [\r\n\t\t[\r\n\t\t\t'requestFullscreen',\r\n\t\t\t'exitFullscreen',\r\n\t\t\t'fullscreenElement',\r\n\t\t\t'fullscreenEnabled',\r\n\t\t\t'fullscreenchange',\r\n\t\t\t'fullscreenerror'\r\n\t\t],\r\n\t\t// New WebKit\r\n\t\t[\r\n\t\t\t'webkitRequestFullscreen',\r\n\t\t\t'webkitExitFullscreen',\r\n\t\t\t'webkitFullscreenElement',\r\n\t\t\t'webkitFullscreenEnabled',\r\n\t\t\t'webkitfullscreenchange',\r\n\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t],\r\n\t\t// Old WebKit\r\n\t\t[\r\n\t\t\t'webkitRequestFullScreen',\r\n\t\t\t'webkitCancelFullScreen',\r\n\t\t\t'webkitCurrentFullScreenElement',\r\n\t\t\t'webkitCancelFullScreen',\r\n\t\t\t'webkitfullscreenchange',\r\n\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t],\r\n\t\t[\r\n\t\t\t'mozRequestFullScreen',\r\n\t\t\t'mozCancelFullScreen',\r\n\t\t\t'mozFullScreenElement',\r\n\t\t\t'mozFullScreenEnabled',\r\n\t\t\t'mozfullscreenchange',\r\n\t\t\t'mozfullscreenerror'\r\n\t\t],\r\n\t\t[\r\n\t\t\t'msRequestFullscreen',\r\n\t\t\t'msExitFullscreen',\r\n\t\t\t'msFullscreenElement',\r\n\t\t\t'msFullscreenEnabled',\r\n\t\t\t'MSFullscreenChange',\r\n\t\t\t'MSFullscreenError'\r\n\t\t]\r\n\t];\r\n\r\n\tlet i = 0;\r\n\tlet l = fnMap.length;\r\n\tlet ret = {} as any;\r\n\r\n\tfor (; i < l; i++) {\r\n\t\tval = fnMap[i];\r\n\t\tif (val && val[1] in document) {\r\n\t\t\tfor (i = 0; i < val.length; i++) {\r\n\t\t\t\tret[fnMap[0][i]] = val[i];\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n})();\r\n\r\ntype EventName = 'change' | 'error';\r\n\r\nclass Screenfull {\r\n\tstatic get isFullscreen() {\r\n\t\treturn Boolean(document[fn.fullscreenElement]);\r\n\t}\r\n\tstatic on(event: EventName, callback: (event: Event) => void) {\r\n    const eventName = event === 'error' ?\r\n      fn.fullscreenerror : fn.fullscreenchange;\r\n    document.addEventListener(eventName, callback, false);\r\n  }\r\n\tstatic off(event: EventName, callback: (event: Event) => void) {\r\n    const eventName = event === 'error' ?\r\n      fn.fullscreenerror : fn.fullscreenchange;\r\n    document.removeEventListener(eventName, callback, false);\r\n  }\r\n  static request(element?: Element) {\r\n    return new Promise<void>((resolve, reject) => {\r\n      const onFullScreenEntered = () => {\r\n        this.off('change', onFullScreenEntered);\r\n        resolve();\r\n      };\r\n\r\n      this.on('change', onFullScreenEntered);\r\n\r\n      const fullscreenElement = element || document.documentElement;\r\n\r\n      const returnPromise = fullscreenElement[fn.requestFullscreen]();\r\n\r\n      if (returnPromise instanceof Promise) {\r\n        returnPromise.then(onFullScreenEntered).catch(reject);\r\n      }\r\n    });\r\n  }\r\n  static exit() {\r\n    return new Promise<void>((resolve, reject) => {\r\n      if (!this.isFullscreen) {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const onFullScreenExit = () => {\r\n        this.off('change', onFullScreenExit);\r\n        resolve();\r\n      };\r\n\r\n      this.on('change', onFullScreenExit);\r\n\r\n      const returnPromise = document[fn.exitFullscreen]();\r\n\r\n      if (returnPromise instanceof Promise) {\r\n        returnPromise.then(onFullScreenExit).catch(reject);\r\n      }\r\n    });\r\n  }\r\n  static toggle(element?: Element){\r\n    return this.isFullscreen ? this.exit() : this.request(element);\r\n  }\r\n  static get isEnabled() {\r\n\t\treturn Boolean(document[fn.fullscreenEnabled]);\r\n\t}\r\n};\r\n\r\nexport default Screenfull;\r\n","import React, {\r\n  useState,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n  useEffect\r\n} from 'react';\r\nimport {\r\n  AppBar,\r\n  Box,\r\n  Toolbar,\r\n  Drawer,\r\n  SwipeableDrawer,\r\n} from '@material-ui/core';\r\nimport {\r\n  RecentFile,\r\n  useDrive,\r\n  useIsSmallScreen,\r\n  useRecentFiles,\r\n} from '../../lib/hooks';\r\nimport Thumbnails from './components/thumbnails';\r\nimport Viewer, { ViewerRef } from './components/viewer';\r\nimport Topbar from './components/topbar';\r\nimport StartScreen from './components/start-screen';\r\nimport Observable from '../../lib/observable';\r\n\r\nconst drawerWidth = 260;\r\nconst preloadCount = 3;\r\nexport const defaultTitle = 'Drive Photos';\r\n\r\nexport interface FileEntry {\r\n  id: string;\r\n  parentId: string;\r\n};\r\n\r\nexport enum FitMode {\r\n  Best = 1,\r\n  Width,\r\n  Height,\r\n  Original,\r\n  Manual\r\n}\r\n\r\nexport interface VisiblePart {\r\n  width: number;\r\n  height: number;\r\n  left: number;\r\n  top: number;\r\n}\r\nexport type VisiblePartHandler = (visiblePart: VisiblePart) => void;\r\n\r\nconst View: React.FC = () => {\r\n  const [ fitMode, setFitMode ] = useState<FitMode>(FitMode.Best);\r\n  const [ parentId, setParentId ] = useState('');\r\n  const [ fileId, setFileId ] = useState('');\r\n  const [ isScrollToBottom, setIsScrollToBottom ] = useState(false);\r\n  const [ title, setTitle ] = useState(defaultTitle);\r\n  const [ isSlideshowPlaying, setSlideshowPlaying ] = useState(false);\r\n  const [\r\n    visibleThumbnails,\r\n    setVisibleThumbnails\r\n  ] = useState<number[]>([]);\r\n  const [ isMobileDrawerOpen, setMobileDrawerOpen ] = useState(false);\r\n\r\n  const toggleMobileDrawer = useCallback(() => {\r\n    setMobileDrawerOpen(current => !current);\r\n  }, []);\r\n  const isSmallScreen = useIsSmallScreen();\r\n\r\n  const {\r\n    isFinished,\r\n    files,\r\n    parent,\r\n    prevDirFile,\r\n    prevDirectory,\r\n    nextDirFile,\r\n    nextDirectory,\r\n    onImageError,\r\n  } = useDrive(fileId, parentId);\r\n\r\n  const {\r\n    recentFiles,\r\n    replace,\r\n    shift,\r\n    remove,\r\n    clear\r\n  } = useRecentFiles();\r\n  const fileJustOpenedRef = useRef(false);\r\n\r\n  const onOpenFile = useCallback((file: FileEntry) => {\r\n    setFileId(file.id);\r\n    setParentId(file.parentId);\r\n    setIsScrollToBottom(false);\r\n    fileJustOpenedRef.current = true;\r\n  }, []);\r\n  const onRecentFile = useCallback((file: RecentFile) => {\r\n    setFileId(file.id);\r\n    setParentId(file.parentId);\r\n    setIsScrollToBottom(false);\r\n    remove(file);\r\n    fileJustOpenedRef.current = true;\r\n  }, [\r\n    remove\r\n  ]);\r\n\r\n  const activeIndex = useMemo(() => {\r\n    if (fileId && files.length > 0) {\r\n      return files.findIndex(file => file.id === fileId);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }, [\r\n    fileId,\r\n    files\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const activeFile = files[activeIndex];\r\n    const fileName = activeFile ? activeFile.name : '';\r\n    if (parent && parent.name && fileName) {\r\n      const title = `${parent.name}/${fileName}`;\r\n      const documentTitle = `${title} | ${defaultTitle}`;\r\n      setTitle(title);\r\n      document.title = documentTitle;\r\n      const recentFile = {\r\n        id: activeFile.id || '',\r\n        parentId: parent.id || '',\r\n        title\r\n      };\r\n      if (fileJustOpenedRef.current) {\r\n        shift(recentFile);\r\n        fileJustOpenedRef.current = false;\r\n      } else {\r\n        replace(recentFile);\r\n      }\r\n    }\r\n  }, [\r\n    activeIndex,\r\n    parent,\r\n    files,\r\n    replace,\r\n    shift\r\n  ]);\r\n\r\n  const counterTitle = useMemo(() => {\r\n    return (activeIndex >= 0 && files.length > 0) ?\r\n      `${activeIndex + 1}/${files.length}` : '';\r\n  }, [\r\n    activeIndex,\r\n    files\r\n  ]);\r\n\r\n  const isFirstImageEnabled = useMemo(() => {\r\n    if (activeIndex < 0 || files.length < 0) {\r\n      return false;\r\n    }\r\n    return (activeIndex > 0);\r\n  }, [\r\n    activeIndex,\r\n    files.length\r\n  ]);\r\n  const isPrevImageEnabled = useMemo(() => {\r\n    if (activeIndex < 0 || files.length < 0) {\r\n      return false;\r\n    }\r\n    return (\r\n      activeIndex > 0 ||\r\n      (isFinished && !!prevDirFile)\r\n    )\r\n  }, [\r\n    isFinished,\r\n    activeIndex,\r\n    files.length,\r\n    prevDirFile\r\n  ]);\r\n  const isNextImageEnabled = useMemo(() => {\r\n    if (activeIndex < 0 || files.length < 0) {\r\n      return false;\r\n    }\r\n    return (\r\n      activeIndex < files.length - 1 ||\r\n      (isFinished && !!nextDirFile)\r\n    )\r\n  }, [\r\n    isFinished,\r\n    activeIndex,\r\n    files.length,\r\n    nextDirFile\r\n  ]);\r\n  const isLastImageEnabled = useMemo(() => {\r\n    if (activeIndex < 0 || files.length < 0) {\r\n      return false;\r\n    }\r\n    return (activeIndex < files.length - 1);\r\n  }, [\r\n    activeIndex,\r\n    files.length\r\n  ]);\r\n  const isSlideshowEnabled = useMemo(() => {\r\n    return isNextImageEnabled;\r\n  }, [\r\n    isNextImageEnabled\r\n  ]);\r\n\r\n  const onFirstImage = useCallback(() => {\r\n    const newIndex = 0;\r\n    if (files[newIndex] && files[newIndex].id) {\r\n      setFileId(files[newIndex].id || '');\r\n      setIsScrollToBottom(false);\r\n    }\r\n  }, [\r\n    files\r\n  ]);\r\n  const onPrevImage = useCallback(() => {\r\n    const newIndex = activeIndex - 1;\r\n    if (files[newIndex] && files[newIndex].id) {\r\n      setFileId(files[newIndex].id || '');\r\n      setIsScrollToBottom(true);\r\n    } else {\r\n      if (isFinished && prevDirectory && prevDirFile) {\r\n        setFileId(prevDirFile.id || '');\r\n        setParentId(prevDirectory.id || '');\r\n        setIsScrollToBottom(true);\r\n        if (prevDirectory.name && prevDirFile.name) {\r\n          const title = `${prevDirectory.name}/${prevDirFile.name}`;\r\n          setTitle(title);\r\n          const documentTitle = `${title} | ${defaultTitle}`;\r\n          document.title = documentTitle;\r\n        }\r\n      }\r\n    }\r\n  }, [\r\n    isFinished,\r\n    activeIndex,\r\n    files,\r\n    prevDirectory,\r\n    prevDirFile\r\n  ]);\r\n  const onNextImage = useCallback(() => {\r\n    const newIndex = activeIndex + 1;\r\n    if (files[newIndex] && files[newIndex].id) {\r\n      setFileId(files[newIndex].id || '');\r\n      setIsScrollToBottom(false);\r\n    } else {\r\n      if (isFinished && nextDirectory && nextDirFile) {\r\n        setFileId(nextDirFile.id || '');\r\n        setParentId(nextDirectory.id || '');\r\n        setIsScrollToBottom(false);\r\n        if (nextDirectory.name && nextDirFile.name) {\r\n          const title = `${nextDirectory.name}/${nextDirFile.name}`;\r\n          setTitle(title);\r\n          const documentTitle = `${title} | ${defaultTitle}`;\r\n          document.title = documentTitle;\r\n        }\r\n      }\r\n    }\r\n  }, [\r\n    isFinished,\r\n    activeIndex,\r\n    files,\r\n    nextDirectory,\r\n    nextDirFile\r\n  ]);\r\n  const onLastImage = useCallback(() => {\r\n    const newIndex = files.length - 1;\r\n    if (files[newIndex] && files[newIndex].id) {\r\n      setFileId(files[newIndex].id || '');\r\n      setIsScrollToBottom(false);\r\n    }\r\n  }, [\r\n    files\r\n  ]);\r\n\r\n  const onSelect = useCallback((fileId: string) => {\r\n    setFileId(fileId);\r\n    setIsScrollToBottom(false);\r\n  }, []);\r\n\r\n  const wasSlideshowPlayingRef = useRef(false);\r\n  useEffect(() => {\r\n    if (!isSlideshowEnabled && isSlideshowPlaying) {\r\n      setSlideshowPlaying(false);\r\n      if (activeIndex === -1) {\r\n        wasSlideshowPlayingRef.current = true;\r\n      }\r\n    }\r\n  }, [\r\n    isSlideshowEnabled,\r\n    isSlideshowPlaying,\r\n    activeIndex,\r\n  ]);\r\n  useEffect(() => {\r\n    if (isSlideshowEnabled && !isSlideshowPlaying &&\r\n      wasSlideshowPlayingRef.current === true\r\n    ) {\r\n      wasSlideshowPlayingRef.current = false;\r\n      setSlideshowPlaying(true);\r\n    }\r\n  }, [\r\n    isSlideshowEnabled,\r\n    isSlideshowPlaying,\r\n  ]);\r\n\r\n  const onToggleSlideshowPlaying = useCallback(() => {\r\n    setSlideshowPlaying(current => !current);\r\n  }, []);\r\n  const onDownloadFile = useCallback(() => {\r\n    const activeFile = files[activeIndex];\r\n    if (activeFile && activeFile.name && activeFile.webContentLink) {\r\n      const name = activeFile.name;\r\n      const url = activeFile.webContentLink;\r\n      const a = document.createElement('a');\r\n      a.download = name;\r\n      a.href = url;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n    }\r\n  }, [\r\n    activeIndex,\r\n    files\r\n  ]);\r\n  const onCloseFile = useCallback(() => {\r\n    setFileId('');\r\n    setParentId('');\r\n    setIsScrollToBottom(false);\r\n    setTitle(defaultTitle);\r\n    document.title = defaultTitle;\r\n  }, []);\r\n  const onSignOut = useCallback(() => {\r\n    onCloseFile();\r\n    clear();\r\n    localStorage.clear();\r\n  }, [\r\n    onCloseFile,\r\n    clear\r\n  ]);\r\n\r\n  const {\r\n    activeFile,\r\n    canPrev,\r\n    prevFile,\r\n    canNext,\r\n    nextFile,\r\n    preloadFiles\r\n  } = useMemo(() => {\r\n    if (activeIndex < 0 || files.length <= 0) {\r\n      return {\r\n        activeFile: undefined,\r\n        canPrev: false,\r\n        prevFile: undefined,\r\n        canNext: false,\r\n        nextFile: undefined,\r\n        preloadFiles: [] as gapi.client.drive.File[]\r\n      }\r\n    }\r\n    const activeFile = files[activeIndex];\r\n    const prevFile = files[activeIndex - 1];\r\n    const nextFile = files[activeIndex + 1];\r\n    const preloadFiles = new Set<gapi.client.drive.File>();\r\n    for (let i = 1; i <= preloadCount; i++) {\r\n      const file = files[activeIndex + i];\r\n      if (file) {\r\n        preloadFiles.add(file);\r\n      }\r\n    }\r\n    for (let i = 1; i <= preloadCount; i++) {\r\n      const file = files[activeIndex - i];\r\n      if (file) {\r\n        preloadFiles.add(file);\r\n      }\r\n    }\r\n    for (let i = 0; i < preloadCount; i++) {\r\n      const file = files[i];\r\n      if (file) {\r\n        preloadFiles.add(file);\r\n      }\r\n    }\r\n    for (let i = files.length - 1; i >= files.length - preloadCount; i--) {\r\n      const file = files[i];\r\n      if (file) {\r\n        preloadFiles.add(file);\r\n      }\r\n    }\r\n    for (let i of visibleThumbnails) {\r\n      const file = files[i];\r\n      if (file) {\r\n        preloadFiles.add(file);\r\n      }\r\n    }\r\n    preloadFiles.delete(activeFile);\r\n    preloadFiles.delete(prevFile);\r\n    preloadFiles.delete(nextFile);\r\n\r\n    return {\r\n      activeFile,\r\n      canPrev: !!prevFile || !!prevDirFile,\r\n      prevFile,\r\n      canNext: !!nextFile || !!nextDirFile,\r\n      nextFile,\r\n      preloadFiles: Array.from(preloadFiles)\r\n    };\r\n  }, [\r\n    activeIndex,\r\n    files,\r\n    visibleThumbnails,\r\n    prevDirFile,\r\n    nextDirFile\r\n  ]);\r\n\r\n  const viewerRef = useRef<ViewerRef>(null);\r\n  const onToggleFullscreen = useCallback(() => {\r\n    if (viewerRef.current) {\r\n      viewerRef.current.toggleFullscreen();\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const onKeyDown = (e: KeyboardEvent) => {\r\n      switch (e.key) {\r\n        case 'Home': {\r\n          onFirstImage();\r\n          break;\r\n        }\r\n        case 'ArrowLeft': {\r\n          onPrevImage();\r\n          break;\r\n        }\r\n        case 'ArrowRight': {\r\n          onNextImage();\r\n          break;\r\n        }\r\n        case 'End': {\r\n          onLastImage();\r\n          break;\r\n        }\r\n        case ' ': {\r\n          onToggleSlideshowPlaying();\r\n          break;\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', onKeyDown);\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', onKeyDown);\r\n    };\r\n  }, [\r\n    onFirstImage,\r\n    onPrevImage,\r\n    onNextImage,\r\n    onLastImage,\r\n    onToggleSlideshowPlaying\r\n  ]);\r\n\r\n  const visiblePartObservable = useRef(new Observable<VisiblePart>());\r\n  const subVisiblePart = useCallback((cb: VisiblePartHandler) => {\r\n    visiblePartObservable.current.subscribe(cb);\r\n    return () => visiblePartObservable.current.unsubscribe(cb);\r\n  }, []);\r\n  const pubVisiblePart = useCallback((visiblePart: VisiblePart) => {\r\n    visiblePartObservable.current.push(visiblePart);\r\n  }, []);\r\n  const onMoveVisible = useCallback((left: number, top: number) => {\r\n    if (viewerRef.current) {\r\n      viewerRef.current.scrollVisibleTo(left, top);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <Box sx={{ display: 'flex' }}>\r\n      <AppBar position='fixed' sx={{ zIndex: (theme) => theme.zIndex.drawer + 1 }}>\r\n        <Topbar\r\n          title={title}\r\n          counterTitle={counterTitle}\r\n          fitMode={fitMode}\r\n          onFitModeChange={setFitMode}\r\n          onOpenFile={onOpenFile}\r\n          onRecentFile={onRecentFile}\r\n          fullscreenButtonActive={files.length > 0}\r\n          onToggleFullscreen={onToggleFullscreen}\r\n          isFirstImageEnabled={isFirstImageEnabled}\r\n          isPrevImageEnabled={isPrevImageEnabled}\r\n          isNextImageEnabled={isNextImageEnabled}\r\n          isLastImageEnabled={isLastImageEnabled}\r\n          isSlideshowEnabled={isSlideshowEnabled}\r\n          isSlideshowPlaying={isSlideshowPlaying}\r\n          onToggleSlideshowPlaying={onToggleSlideshowPlaying}\r\n          onFirstImage={onFirstImage}\r\n          onPrevImage={onPrevImage}\r\n          onNextImage={onNextImage}\r\n          onLastImage={onLastImage}\r\n          recentFiles={recentFiles}\r\n          onDownloadFile={onDownloadFile}\r\n          onCloseFile={onCloseFile}\r\n          onSignOut={onSignOut}\r\n          isMobileDrawerOpen={isMobileDrawerOpen}\r\n          toggleMobileDrawer={toggleMobileDrawer}\r\n        />\r\n      </AppBar>\r\n      {isSmallScreen ?\r\n        <SwipeableDrawer\r\n          anchor='left'\r\n          open={isMobileDrawerOpen}\r\n          onOpen={toggleMobileDrawer}\r\n          onClose={toggleMobileDrawer}\r\n          sx={{\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n            [`& .MuiDrawer-paper`]: {\r\n              width: drawerWidth,\r\n              boxSizing: 'border-box'\r\n            },\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n          }}\r\n          ModalProps={{\r\n            keepMounted: true,\r\n          }}\r\n        >\r\n          <Toolbar />\r\n          <Thumbnails\r\n            files={files}\r\n            fileId={fileId}\r\n            onSelect={onSelect}\r\n            onVisibleFiles={setVisibleThumbnails}\r\n            onImageError={onImageError}\r\n            sx={{\r\n              flexGrow: 1\r\n            }}\r\n          />\r\n        </SwipeableDrawer> :\r\n        <Drawer\r\n          variant='permanent'\r\n          sx={{\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n            [`& .MuiDrawer-paper`]: {\r\n              width: drawerWidth,\r\n              boxSizing: 'border-box'\r\n            },\r\n            display: 'flex',\r\n            flexDirection: 'column'\r\n          }}\r\n        >\r\n          <Toolbar />\r\n          <Thumbnails\r\n            files={files}\r\n            fileId={fileId}\r\n            onSelect={onSelect}\r\n            onVisibleFiles={setVisibleThumbnails}\r\n            onImageError={onImageError}\r\n            subVisiblePart={subVisiblePart}\r\n            onMoveVisible={onMoveVisible}\r\n            sx={{\r\n              flexGrow: 1\r\n            }}\r\n          />\r\n        </Drawer>\r\n      }\r\n      <Box component='main' sx={{\r\n        flexGrow: 1,\r\n        height: '100vh',\r\n        display: 'flex',\r\n        flexDirection: 'column'\r\n      }}>\r\n        <Toolbar />\r\n        {fileId ?\r\n          <Viewer\r\n            fitMode={fitMode}\r\n            fileId={fileId}\r\n            file={activeFile}\r\n            canPrev={canPrev}\r\n            prevFile={prevFile}\r\n            canNext={canNext}\r\n            nextFile={nextFile}\r\n            preloadFiles={preloadFiles}\r\n            onPrevImage={onPrevImage}\r\n            onNextImage={onNextImage}\r\n            onFitModeChange={setFitMode}\r\n            isScrollToBottom={isScrollToBottom}\r\n            isSlideshowEnabled={isSlideshowEnabled}\r\n            isSlideshowPlaying={isSlideshowPlaying}\r\n            onToggleSlideshowPlaying={onToggleSlideshowPlaying}\r\n            onImageError={onImageError}\r\n            onVisibleChange={pubVisiblePart}\r\n            sx={{\r\n              flexGrow: 1\r\n            }}\r\n            ref={viewerRef}\r\n          /> :\r\n          <StartScreen\r\n            onOpenFile={onOpenFile}\r\n            sx={{\r\n              flexGrow: 1\r\n            }}\r\n          />\r\n        }\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default View;\r\n","import {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState\r\n} from 'react';\r\nimport {\r\n  DirectoryEdge,\r\n  getEdgeFiles,\r\n  getParent,\r\n  getProfile,\r\n  isSignedIn,\r\n  listDirectories,\r\n  listFiles,\r\n  signIn,\r\n  signOut,\r\n  subscribeToGapiErrors,\r\n  subscribeToSignedInChange,\r\n  getGapiError,\r\n  Profile,\r\n  getFile\r\n} from './api';\r\nimport Screenfull from './screenfull';\r\nimport { useTheme } from '@material-ui/core/styles';\r\nimport { useMediaQuery } from '@material-ui/core';\r\n\r\nconst recentLocalStorageKey = 'recent';\r\nconst recentLength = 10;\r\n\r\nconst useAbortSignal = () => {\r\n  const abortControllerRef = useRef(new AbortController());\r\n\r\n  useEffect(() => {\r\n    const abortController = abortControllerRef.current;\r\n    return () => {\r\n      abortController.abort();\r\n    };\r\n  }, []);\r\n\r\n  return abortControllerRef.current.signal;\r\n};\r\n\r\nconst useIsSignedIn = (onSignOut?: () => void) => {\r\n  const [ signedIn, setSignedIn ] = useState(isSignedIn());\r\n  const [ profile, setProfile ] = useState<Profile | null>(null);\r\n  const [ gapiError, setGapiError ] = useState(getGapiError());\r\n  const [ isCookiesError, setCookiesError ] = useState(false);\r\n  \r\n  useEffect(() => {\r\n    return subscribeToSignedInChange(setSignedIn);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return subscribeToGapiErrors(setGapiError);\r\n  }, []);\r\n\r\n  const toggleSignedIn = useCallback(() => {\r\n    // console.log('toggleSignedIn');\r\n    if (!signedIn) {\r\n      signIn();\r\n    } else {\r\n      if (onSignOut) {\r\n        onSignOut();\r\n      }\r\n      signOut();\r\n    }\r\n  }, [\r\n    signedIn,\r\n    onSignOut\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (signedIn) {\r\n      const profile = getProfile();\r\n      setProfile(profile);\r\n    } else {\r\n      setProfile(null);\r\n    }\r\n  }, [\r\n    signedIn\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (gapiError && gapiError.details &&\r\n      gapiError.details === 'Cookies are not enabled in current environment.'\r\n    ) {\r\n      setCookiesError(true);\r\n    } else {\r\n      setCookiesError(false);\r\n    }\r\n  }, [\r\n    gapiError\r\n  ]);\r\n\r\n  return {\r\n    isSignedIn: signedIn,\r\n    toggleSignedIn,\r\n    profile,\r\n    isCookiesError\r\n  };\r\n};\r\n\r\nconst useFiles = (fileId: string, parentId: string) => {\r\n  const [ file, setFile ] = useState<gapi.client.drive.File | undefined>();\r\n  const [ files, setFiles ] = useState<gapi.client.drive.File[]>([]);\r\n  const [ pageToken, setPageToken ] = useState<string | undefined>();\r\n  const signal = useAbortSignal();\r\n  const parentIdRef = useRef<string | undefined>(parentId);\r\n  const [ isFinished, setFinished ] = useState(false);\r\n  const [ isCleared, setCleared ] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      try {\r\n        const file = await getFile(fileId);\r\n        if(!signal.aborted && file) {\r\n          setFile(file);\r\n        }\r\n      }\r\n      catch(err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n\r\n    if (parentId !== parentIdRef.current || isCleared) {\r\n      setCleared(false);\r\n      if (parentIdRef.current) {\r\n        setFiles([]);\r\n        setFile(undefined);\r\n        setPageToken(undefined);\r\n        setFinished(false);\r\n      }\r\n      parentIdRef.current = parentId;\r\n      if (fileId) {\r\n        run();\r\n      } else {\r\n        setFile(undefined);\r\n      }\r\n    }\r\n  }, [\r\n    parentId,\r\n    fileId,\r\n    isCleared,\r\n    signal\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      if (!parentId) {\r\n        return;\r\n      }\r\n      try {\r\n        const result = await listFiles({\r\n          parentId,\r\n          pageToken\r\n        });\r\n        if(!signal.aborted && result) {\r\n          setFiles(prevFiles => prevFiles.concat(result.files || []));\r\n          setFinished(!result.nextPageToken);\r\n          setPageToken(result.nextPageToken);\r\n        }\r\n      }\r\n      catch(err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n\r\n    if (parentId && !isFinished) {\r\n      run();\r\n    }\r\n  }, [\r\n    parentId,\r\n    pageToken,\r\n    signal,\r\n    isFinished\r\n  ]);\r\n  \r\n  const clear = useCallback(() => {\r\n    setCleared(true);\r\n  }, []);\r\n\r\n  const readyFiles = useMemo(() => {\r\n    if (file && file.id && !files.find(other => other.id === file.id)) {\r\n      return [ file ];\r\n    } else return files;\r\n  }, [\r\n    file,\r\n    files\r\n  ]);\r\n  return {\r\n    files: readyFiles,\r\n    isFinished,\r\n    clear\r\n  };\r\n};\r\n\r\nconst useDirectory = (parentId?: string) => {\r\n  const [\r\n    directory,\r\n    setDirectory\r\n  ] = useState<gapi.client.drive.File | undefined>(undefined);\r\n  const signal = useAbortSignal();\r\n  const parentIdRef = useRef<string | undefined>(parentId);\r\n\r\n  useEffect(() => {\r\n    if (parentId !== parentIdRef.current) {\r\n      if (parentIdRef.current) {\r\n        setDirectory(undefined);\r\n      }\r\n      parentIdRef.current = parentId;\r\n    }\r\n  }, [\r\n    parentId\r\n  ]);\r\n  \r\n  useEffect(() => {\r\n    const run = async () => {\r\n      if (!parentId) {\r\n        return;\r\n      }\r\n      try {\r\n        const directory = await getParent(parentId);\r\n        if(!signal.aborted && directory) {\r\n          setDirectory(directory);\r\n        }\r\n      }\r\n      catch(err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n\r\n    if (parentId) {\r\n      run();\r\n    }\r\n  }, [\r\n    parentId,\r\n    signal\r\n  ]);\r\n  \r\n  return directory;\r\n};\r\n\r\nconst useGrandParentId = (parent?: gapi.client.drive.File) => {\r\n  const [ grandParentId, setGrandParentId ] = useState<string | undefined>();\r\n\r\n  useEffect(() => {\r\n    setGrandParentId((parent && parent.parents) ?\r\n      parent.parents[0] : undefined\r\n    );\r\n  }, [\r\n    parent,\r\n  ]);\r\n  \r\n  return grandParentId;\r\n};\r\n\r\nconst useFullScreen = () => {\r\n  const [ isFullscreen, setFullscreen ] = useState(Screenfull.isFullscreen);\r\n  const [ isEnabled ] = useState(Screenfull.isEnabled);\r\n\r\n  useEffect(() => {\r\n    if (!Screenfull.isEnabled) {\r\n      return;\r\n    }\r\n    const run = () => {\r\n      const isFullscreen = Screenfull.isFullscreen;\r\n      setFullscreen(isFullscreen);\r\n    };\r\n    run();\r\n    Screenfull.on('change', run);\r\n    return () => {\r\n      Screenfull.off('change', run);\r\n    };\r\n  }, []);\r\n\r\n  const toggleFullScreen = useCallback((div?: HTMLDivElement | null) => {\r\n    const run = async () => {\r\n      if (!Screenfull.isEnabled) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        Screenfull.toggle(div || undefined);\r\n      }\r\n      catch (err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n    run();\r\n  }, []);\r\n\r\n  return {\r\n    isEnabled,\r\n    isFullscreen,\r\n    toggleFullScreen\r\n  };\r\n};\r\n\r\ninterface UseEdgeFileOptions {\r\n  parent: gapi.client.drive.File | undefined;\r\n  edge: DirectoryEdge;\r\n};\r\n\r\nconst useEdgeFile = (options: UseEdgeFileOptions) => {\r\n  const {\r\n    parent,\r\n    edge\r\n  } = options;\r\n  const [ file, setFile ] = useState<gapi.client.drive.File | undefined>();\r\n  const signal = useAbortSignal();\r\n  const parentIdRef = useRef<string | undefined>(parent?.id);\r\n\r\n  useEffect(() => {\r\n    if (parent?.id !== parentIdRef.current) {\r\n      if (parentIdRef.current) {\r\n        setFile(undefined);\r\n      }\r\n      parentIdRef.current = parent?.id;\r\n    }\r\n  }, [\r\n    parent\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      if (!parent || !parent.id) {\r\n        return;\r\n      }\r\n      try {\r\n        const edgeFiles = await getEdgeFiles({\r\n          parentId: parent.id,\r\n          edge\r\n        });\r\n        if(!signal.aborted){\r\n          if (edgeFiles && edgeFiles.length && edgeFiles[0]) {\r\n            setFile(edgeFiles[0]);\r\n          } else {\r\n            setFile(undefined);\r\n          }\r\n        }\r\n      }\r\n      catch(err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n\r\n    if (parent && parent.id) {\r\n      run();\r\n    } else {\r\n      setFile(undefined);\r\n    }\r\n  }, [\r\n    parent,\r\n    edge,\r\n    signal\r\n  ]);\r\n  \r\n  return file;\r\n};\r\n\r\nconst useDirectories = (grandParentId?: string) => {\r\n  const [\r\n    directories,\r\n    setDirectories\r\n  ] = useState<gapi.client.drive.File[]>([]);\r\n  const [ pageToken, setPageToken ] = useState<string | undefined>();\r\n  const cacheIdRef = useRef<string | undefined>(grandParentId);\r\n  const cacheDirectoriesRef = useRef<gapi.client.drive.File[]>([]);\r\n  const [ isFinished, setFinished ] = useState(false);\r\n  const signal = useAbortSignal();\r\n\r\n  useEffect(() => {\r\n    if (!grandParentId) {\r\n      setDirectories([]);\r\n      setPageToken(undefined);\r\n      setFinished(false);\r\n    } else if (grandParentId === cacheIdRef.current) {\r\n      setDirectories(cacheDirectoriesRef.current);\r\n      setPageToken(undefined);\r\n      setFinished(true);\r\n    }\r\n  }, [\r\n    grandParentId,\r\n    signal\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      if (!grandParentId) {\r\n        return;\r\n      }\r\n      try {\r\n        const result = await listDirectories({\r\n          grandParentId,\r\n          pageToken,\r\n        });\r\n        if(!signal.aborted && result) {\r\n          setDirectories(prevDirectories => \r\n            prevDirectories.concat(result.files || [])\r\n          );\r\n          setFinished(!result.nextPageToken);\r\n          setPageToken(result.nextPageToken);\r\n        }\r\n      }\r\n      catch(err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n\r\n    if (grandParentId && !isFinished &&\r\n      grandParentId !== cacheIdRef.current\r\n    ) {\r\n      run();\r\n    }\r\n  }, [\r\n    grandParentId,\r\n    isFinished,\r\n    pageToken,\r\n    signal,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (isFinished && grandParentId) {\r\n      cacheDirectoriesRef.current = directories.slice();\r\n      cacheIdRef.current = grandParentId;\r\n    }\r\n  }, [\r\n    grandParentId,\r\n    directories,\r\n    isFinished,\r\n  ]);\r\n  \r\n  return directories;\r\n};\r\n\r\nconst clearCooldown = 5 * 60 * 1000;\r\n\r\nconst useDrive = (fileId: string, parentId: string) => {\r\n  const {\r\n    files,\r\n    isFinished,\r\n    clear\r\n   } = useFiles(fileId, parentId);\r\n  const parent = useDirectory(parentId);\r\n  const grandParentId = useGrandParentId(parent);\r\n\r\n  const directories = useDirectories(grandParentId);\r\n  const directoryIndex = useMemo(() => {\r\n    return directories.findIndex(sibling => sibling.id === parentId);\r\n  }, [\r\n    parentId,\r\n    directories\r\n  ]);\r\n  const prevDirectory = useMemo(() => {\r\n    return directories[directoryIndex - 1] ?\r\n      directories[directoryIndex - 1] : undefined;\r\n  }, [\r\n    directories,\r\n    directoryIndex\r\n  ]);\r\n  const nextDirectory = useMemo(() => {\r\n    return directories[directoryIndex + 1] ?\r\n      directories[directoryIndex + 1] : undefined;\r\n  }, [\r\n    directories,\r\n    directoryIndex\r\n  ]);\r\n  const prevDirFile = useEdgeFile({\r\n    parent: prevDirectory,\r\n    edge: DirectoryEdge.End\r\n  });\r\n  const nextDirFile = useEdgeFile({\r\n    parent: nextDirectory,\r\n    edge: DirectoryEdge.Begin\r\n  });\r\n\r\n  const lastClearedTimeRef = useRef(0);\r\n\r\n  const onImageError = useCallback(() => {\r\n    const now = new Date().getTime();\r\n    if (now - lastClearedTimeRef.current > clearCooldown) {\r\n      lastClearedTimeRef.current = now;\r\n      clear();\r\n    }\r\n  }, [\r\n    clear\r\n  ]);\r\n\r\n  return {\r\n    isFinished,\r\n    files,\r\n    parent,\r\n    prevDirFile,\r\n    prevDirectory,\r\n    nextDirFile,\r\n    nextDirectory,\r\n    onImageError\r\n  }\r\n};\r\n\r\n\r\nexport interface RecentFile {\r\n  id: string;\r\n  parentId: string;\r\n  title: string;\r\n};\r\n\r\nconst useRecentFiles = () => {\r\n  const [ recentFiles, setRecentFiles ] = useState<RecentFile[]>([]);\r\n  const recentJsonRef = useRef<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const recentJson = localStorage.getItem(recentLocalStorageKey);\r\n    recentJsonRef.current = recentJson;\r\n\r\n    if (recentJson) {\r\n      setRecentFiles(JSON.parse(recentJson));\r\n    }\r\n  }, []);\r\n\r\n  const replace = useCallback((file: RecentFile) => {\r\n    setRecentFiles(\r\n      current => [file].concat(current.slice(1))\r\n    );\r\n  }, []);\r\n  const shift = useCallback((file: RecentFile) => {\r\n    setRecentFiles(\r\n      current => [file].concat(current.slice(0, recentLength - 1))\r\n    );\r\n  }, []);\r\n  const remove = useCallback((file: RecentFile) => {\r\n    setRecentFiles(\r\n      current => current.filter(other => other.id !== file.id)\r\n    );\r\n  }, []);\r\n  const clear = useCallback(() => {\r\n    setRecentFiles([]);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (recentFiles.length > 0) {\r\n      const recentJson = JSON.stringify(recentFiles);\r\n  \r\n      if (recentJson !== recentJsonRef.current) {\r\n        localStorage.setItem(recentLocalStorageKey, recentJson);\r\n        recentJsonRef.current = recentJson;\r\n      }\r\n    } else {\r\n      if (localStorage.getItem(recentLocalStorageKey)) {\r\n        localStorage.removeItem(recentLocalStorageKey);\r\n        recentJsonRef.current = null\r\n      }\r\n    }\r\n  }, [\r\n    recentFiles\r\n  ]);\r\n\r\n  return {\r\n    recentFiles,\r\n    replace,\r\n    shift,\r\n    remove,\r\n    clear\r\n  };\r\n};\r\n\r\nconst useIsSmallScreen = () => {\r\n  const theme = useTheme();\r\n  const isSmallScreen = useMediaQuery(theme.breakpoints.down('md'));\r\n  return isSmallScreen;\r\n};\r\n\r\nconst useIsTouchScreen = () => {\r\n  const isTouchScreen = useMediaQuery('(pointer:coarse)');\r\n  return isTouchScreen;\r\n};\r\n\r\nlet calculatedWidth: number | undefined;\r\nconst useBrowserScrollbarWidth = () => {\r\n  const [ width, setWidth ] = useState(calculatedWidth || 0);\r\n\r\n  useEffect(() => {\r\n    if (calculatedWidth !== undefined) {\r\n      return;\r\n    }\r\n    const outer = document.createElement('div');\r\n    outer.style.visibility = 'hidden';\r\n    outer.style.overflow = 'scroll';\r\n    document.body.appendChild(outer);\r\n\r\n    const inner = document.createElement('div');\r\n    outer.appendChild(inner);\r\n\r\n    const scrollbarWidth = (outer.offsetWidth - inner.offsetWidth);\r\n    outer.parentNode?.removeChild(outer);\r\n    setWidth(scrollbarWidth);\r\n  }, []);\r\n\r\n  return width;\r\n};\r\n\r\nexport {\r\n  useAbortSignal,\r\n  useIsSignedIn,\r\n  useFiles,\r\n  useDirectory,\r\n  useFullScreen,\r\n  useDrive,\r\n  useRecentFiles,\r\n  useIsSmallScreen,\r\n  useIsTouchScreen,\r\n  useBrowserScrollbarWidth,\r\n};\r\n","import {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback\r\n} from 'react';\r\nimport { useAbortSignal } from '../../../../lib/hooks';\r\n\r\nconst useDebounce = <T>(value: T, delay: number) => {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n\r\n  useEffect(\r\n    () => {\r\n      const timeout = setTimeout(() => {\r\n        setDebouncedValue(value);\r\n      }, delay);\r\n      return () => {\r\n        clearTimeout(timeout);\r\n      };\r\n    },\r\n    [value, delay]\r\n  );\r\n\r\n  return debouncedValue;\r\n};\r\n\r\nconst useScroll = (ref: React.RefObject<HTMLDivElement>) => {\r\n  const [scrollTop, setScrollTop] = useState(0);\r\n  // const debouncedScrollTop = useDebounce(scrollTop, 15);\r\n  const signal = useAbortSignal();\r\n  const [ isScrolling, setScrolling ] = useState(false);\r\n  const isScrollingHandlerRef = useRef<NodeJS.Timeout>();\r\n\r\n  const setIsScrolling = useCallback(() => {\r\n    if (isScrollingHandlerRef.current) {\r\n      clearTimeout(isScrollingHandlerRef.current);\r\n    }\r\n    setScrolling(true);\r\n    isScrollingHandlerRef.current = setTimeout(() => {\r\n      if (!signal.aborted) {\r\n        setScrolling(false);\r\n      }\r\n    }, 300)\r\n  }, [\r\n    signal\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const scrollContainer = ref.current;\r\n    if (!scrollContainer) {\r\n      return;\r\n    }\r\n\r\n    const onScroll = (e: Event) => {\r\n      const div = e.target as HTMLDivElement;\r\n      if (div) {\r\n        setScrollTop(+div.scrollTop);\r\n        setIsScrolling();\r\n      }\r\n    };\r\n\r\n    setScrollTop(scrollContainer.scrollTop);\r\n    scrollContainer.addEventListener('scroll', onScroll);\r\n    return () => scrollContainer.removeEventListener('scroll', onScroll);\r\n  }, [\r\n    ref,\r\n    setIsScrolling\r\n  ]);\r\n\r\n  \r\n  return {\r\n    scrollTop,\r\n    isScrolling\r\n  };\r\n  // return debouncedScrollTop;\r\n};\r\n\r\nexport interface RectSize {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nconst useRectSize = () => {\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const [ rectSize, setRectSize ] = useState({\r\n    width: 0,\r\n    height: 0\r\n  } as RectSize);\r\n  const debouncedRectSize = useDebounce(rectSize, 150);\r\n  const signal = useAbortSignal();\r\n\r\n  const check = useCallback(async () => {\r\n    requestAnimationFrame(() => {\r\n      const div = ref.current;\r\n      if (div && !signal.aborted) {\r\n        setRectSize({\r\n          width: div.offsetWidth,\r\n          height: div.offsetHeight\r\n        } as RectSize)\r\n      }\r\n    });\r\n  }, [\r\n    signal\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    check();\r\n    window.addEventListener('resize', check);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', check);\r\n    };\r\n  }, [\r\n    check,\r\n    signal\r\n  ]);\r\n\r\n\r\n  return {\r\n    ref,\r\n    rectSize: debouncedRectSize\r\n  };\r\n};\r\n\r\nexport {\r\n  useDebounce,\r\n  useScroll,\r\n  useRectSize\r\n}\r\n","const easeInOutSine = (\r\n  time: number, \r\n  timeFrom: number,\r\n  timeTo: number,\r\n  valFrom: number,\r\n  valTo: number,\r\n) => -(valTo - valFrom) / 2 * (\r\n  Math.cos(Math.PI * (time - timeFrom) / (timeTo - timeFrom)) - 1\r\n) + valFrom;\r\n\r\nconst easeInOutCap = (\r\n  time: number, \r\n  timeFrom: number,\r\n  timeCapFraction: number,\r\n  timeTo: number,\r\n  valFrom: number,\r\n  valCap: number,\r\n  valTo: number,\r\n) => {\r\n  const timeCap = timeFrom + (timeTo - timeFrom) * timeCapFraction;\r\n\r\n  // console.log({\r\n  //   time, \r\n  //   timeFrom,\r\n  //   timeCap,\r\n  //   timeTo,\r\n  //   valFrom,\r\n  //   valCap,\r\n  //   valTo\r\n  // });\r\n  if (time < timeCap) {\r\n    return easeInOutSine(time, timeFrom, timeCap, valFrom, valCap);\r\n  } else if (time < timeTo - timeCap) {\r\n    return valCap;\r\n  } else {\r\n    return easeInOutSine(time, timeTo - timeCap, timeTo, valCap, valTo);\r\n  }\r\n};\r\n\r\nexport {\r\n  easeInOutSine,\r\n  easeInOutCap\r\n};\r\n","import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Box,\r\n} from '@material-ui/core';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system';\r\nimport { useDebounce, useRectSize } from '../../../../view/components/thumbnails/hooks';\r\nimport { easeInOutCap, easeInOutSine } from './helpers';\r\n\r\nconst cellToSlideRatio = 1.3;\r\nconst numColumns = 5;\r\nconst slidePadding = 1;\r\nconst jumpCapRatio = 1.5;\r\nconst jumpCapFraction = 0.3;\r\n\r\ninterface SlideWithCoordinates {\r\n  row: number;\r\n  column: number;\r\n  shift: number[];\r\n  slide: JSX.Element;\r\n};\r\n\r\ninterface SpaceProps {\r\n  slides: JSX.Element[];\r\n  slideHeight: number;\r\n  jumpHeight: number;\r\n  scrollTop: number;\r\n  isJumping: boolean;\r\n  setJumping: (isJumping: boolean) => void;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst Space: React.FC<SpaceProps> = (props) => {\r\n  const {\r\n    slides,\r\n    slideHeight,\r\n    jumpHeight,\r\n    scrollTop,\r\n    isJumping,\r\n    setJumping,\r\n    sx\r\n  } = props;\r\n\r\n  const cellSize = useMemo(() => {\r\n    return slideHeight * cellToSlideRatio\r\n  }, [\r\n    slideHeight\r\n  ]);\r\n  const randomShift = useCallback(() => {\r\n    return [\r\n      Math.random() * cellSize / 2,\r\n      Math.random() * cellSize / 2,\r\n      Math.random() * cellSize / 2\r\n    ];\r\n  }, [\r\n    cellSize\r\n  ]);\r\n  const slidesWithCoordinates = useMemo(() => {\r\n    const list = [] as SlideWithCoordinates[];\r\n    const hash = new Map<number, SlideWithCoordinates>();\r\n    for (let i = 0; i < slides.length; i++) {\r\n      const slide = slides[i];\r\n      const row = (slidePadding * 2 + 1) * i + slidePadding;\r\n      const column = Math.floor(\r\n        (numColumns - slidePadding * 2) * Math.random()\r\n      ) + slidePadding;\r\n      const key = row * numColumns + column;\r\n      const slideWithCoordinates = {\r\n        row,\r\n        column,\r\n        shift: randomShift(),\r\n        slide\r\n      };\r\n      list.push(slideWithCoordinates);\r\n      hash.set(key, slideWithCoordinates);\r\n    }\r\n    return {\r\n      list,\r\n      hash\r\n    };\r\n  }, [\r\n    randomShift,\r\n    slides\r\n  ]);\r\n\r\n  const cells = useMemo(() => {\r\n    const cells = [] as JSX.Element[];\r\n    const numRows = slides.length * (slidePadding * 2 + 1);\r\n    for (let i = 0; i < numRows; i++) {\r\n      for (let j = 0; j < numColumns; j++) {\r\n        const key = i * numColumns + j;\r\n        const slideWithCoordinates = slidesWithCoordinates.hash.get(key);\r\n        if (slideWithCoordinates) {\r\n          const {\r\n            slide,\r\n            shift\r\n          } = slideWithCoordinates;\r\n          const dx = cellSize * j + shift[0];\r\n          const dy = cellSize * i + shift[1];\r\n          const dz = shift[2];\r\n          cells.push(\r\n            <Box\r\n              key={key}\r\n              sx={{\r\n                transform: `translate3d(${dx}px, ${dy}px, ${dz}px)`,\r\n                position: 'absolute',\r\n                width: '100%'\r\n              }}\r\n            >\r\n              {slide}\r\n            </Box>\r\n          );\r\n        } else {\r\n          const shift = randomShift();\r\n          const dx = cellSize * j + shift[0];\r\n          const dy = cellSize * i + shift[1];\r\n          const dz = shift[2];\r\n          cells.push(\r\n            <Box\r\n              key={key}\r\n              component='img'\r\n              src={`https://picsum.photos/300/400?random=${key}`}\r\n              loading='lazy'\r\n              sx={{\r\n                height: `${slideHeight}px`,\r\n                width: 'auto',\r\n                transform: `translate3d(${dx}px, ${dy}px, ${dz}px)`,\r\n                position: 'absolute',\r\n              }}\r\n            />\r\n          );\r\n        }\r\n      }\r\n    }\r\n    return cells;\r\n  }, [\r\n    slideHeight,\r\n    cellSize,\r\n    randomShift,\r\n    slides.length,\r\n    slidesWithCoordinates\r\n  ]);\r\n\r\n  const {\r\n    rectSize,\r\n    ref\r\n  } = useRectSize();\r\n  const calculateShift = useCallback((scrollTop: number) => {\r\n    const scrollMax = slideHeight + jumpHeight;\r\n    const slideIndex = Math.floor(scrollTop / scrollMax);\r\n    const scroll = scrollTop % scrollMax;\r\n    const scrollJump = slideHeight - rectSize.height;\r\n    if (scroll <= scrollJump ||\r\n      slideIndex >= slidesWithCoordinates.list.length - 1\r\n    ) {\r\n      const curr = slidesWithCoordinates.list[slideIndex];\r\n      const currX = cellSize * curr.column + curr.shift[0];\r\n      const currY = cellSize * curr.row + curr.shift[1];\r\n      const currZ = curr.shift[2];\r\n      return [\r\n        -currX,\r\n        -currY - scroll,\r\n        -currZ\r\n      ];\r\n    } else {\r\n      const prev = slidesWithCoordinates.list[slideIndex];\r\n      const next = slidesWithCoordinates.list[slideIndex + 1];\r\n      const prevX = cellSize * prev.column + prev.shift[0];\r\n      const prevY = cellSize * prev.row + prev.shift[1] + scrollJump;\r\n      const prevZ = prev.shift[2];\r\n      const nextX = cellSize * next.column + next.shift[0];\r\n      const nextY = cellSize * next.row + next.shift[1];\r\n      const nextZ = next.shift[2];\r\n      const x = easeInOutSine(scroll, scrollJump, scrollMax, prevX, nextX);\r\n      const y = easeInOutSine(scroll, scrollJump, scrollMax, prevY, nextY);\r\n      const z = easeInOutCap(\r\n        scroll,\r\n        scrollJump,\r\n        jumpCapFraction,\r\n        scrollMax,\r\n        prevZ,\r\n        slideHeight * jumpCapRatio,\r\n        nextZ\r\n      );\r\n\r\n      // console.log({\r\n      //   scroll,\r\n      //   scrollJump,\r\n      //   scrollMax,\r\n      //   prev,\r\n      //   next,\r\n      //   prevX,\r\n      //   prevY,\r\n      //   prevZ,\r\n      //   nextX,\r\n      //   nextY,\r\n      //   nextZ,\r\n      //   x,\r\n      //   y,\r\n      //   z\r\n      // });\r\n      return [\r\n        -x,\r\n        -y,\r\n        -z\r\n      ];\r\n    }\r\n  }, [\r\n    slideHeight,\r\n    jumpHeight,\r\n    rectSize.height,\r\n    cellSize,\r\n    slidesWithCoordinates\r\n  ]);\r\n  const planeShift = calculateShift(scrollTop);\r\n\r\n  useEffect(() => {\r\n    const scrollJump = slideHeight - rectSize.height;\r\n    if (scrollTop % (slideHeight + jumpHeight) > scrollJump) {\r\n      setJumping(true);\r\n    }\r\n  }, [\r\n    slideHeight,\r\n    jumpHeight,\r\n    rectSize.height,\r\n    setJumping,\r\n    scrollTop\r\n  ]);\r\n  const debouncedSrollTop = useDebounce(scrollTop, 1000);\r\n  useEffect(() => {\r\n    const scrollJump = slideHeight - rectSize.height;\r\n    if (debouncedSrollTop % (slideHeight + jumpHeight) <= scrollJump) {\r\n      setJumping(false);\r\n    }\r\n  }, [\r\n    slideHeight,\r\n    jumpHeight,\r\n    rectSize.height,\r\n    setJumping,\r\n    debouncedSrollTop\r\n  ]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        ...sx,\r\n        backgroundColor: 'black',\r\n        perspective: '25vh',\r\n        willChange: 'transform'\r\n      }}\r\n      ref={ref}\r\n    >\r\n      <Box\r\n        sx={{\r\n          position: 'relative',\r\n          transformStyle: 'preserve-3d',\r\n          transform: `translate3d(${planeShift\r\n            .map(shift => `${shift}px`)\r\n            .join(',')\r\n          })`,\r\n          transition: isJumping ? 'transform 1s ease-out' : undefined\r\n        }}\r\n      >\r\n        {cells}\r\n      </Box>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Space;\r\n","import React, { useMemo, useState } from 'react';\r\nimport {\r\n  Box, Toolbar\r\n} from '@material-ui/core';\r\nimport Comix, {\r\n  slides\r\n} from './comix';\r\nimport Space from './space';\r\nimport { useScrollAware } from './hooks';\r\nimport { useIsTouchScreen } from '../../../../lib/hooks';\r\n\r\nconst Landing: React.FC = () => {\r\n  const scrollTop = useScrollAware();\r\n  const isTouchScreen = useIsTouchScreen();\r\n  const slideHeight = Math.round(2.03 * document.documentElement.clientHeight);\r\n  const [ isJumping, setJumping ] = useState(false);\r\n  const jumpHeight = useMemo(\r\n    () => isTouchScreen ? 20 : 2500,\r\n    [isTouchScreen]\r\n  );\r\n\r\n  return (\r\n    <Box>\r\n      <Box\r\n        sx={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          left: 0,\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          zIndex: isJumping ? undefined : -1\r\n        }}\r\n      >\r\n        <Toolbar/>\r\n        {!isTouchScreen ?\r\n          <Space\r\n            scrollTop={scrollTop}\r\n            slideHeight={slideHeight}\r\n            jumpHeight={jumpHeight}\r\n            slides={slides}\r\n            isJumping={isJumping}\r\n            setJumping={setJumping}\r\n            sx={{\r\n              flexGrow: 1,\r\n              overflow: 'hidden',\r\n              visibility: isJumping ? 'visible' : 'hidden'\r\n            }}\r\n          /> : null\r\n        }\r\n      </Box>\r\n      <Comix\r\n        jumpHeight={jumpHeight}\r\n        sx={{\r\n          visibility: isJumping ? 'hidden' : 'visible'\r\n        }}\r\n      />\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default Landing;\r\n","import {\r\n  useState,\r\n  useEffect,\r\n} from 'react';\r\nimport { useAbortSignal } from '../../../../lib/hooks';\r\n\r\nconst useScrollAware = () => {\r\n  const [scrollTop, setScrollTop] = useState(0);\r\n  const signal = useAbortSignal();\r\n\r\n  useEffect(() => {\r\n    const onScroll = () => {\r\n      if (!signal.aborted) {\r\n        setScrollTop(+document.documentElement.scrollTop);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('scroll', onScroll);\r\n    return () => document.removeEventListener('scroll', onScroll);\r\n  }, [\r\n    signal\r\n  ]);\r\n\r\n  return scrollTop;\r\n};\r\n\r\nexport {\r\n  useScrollAware,\r\n}\r\n","import React, {\r\n} from 'react';\r\nimport {\r\n  AppBar,\r\n  Box,\r\n  Toolbar,\r\n} from '@material-ui/core';\r\nimport Topbar from './components/topbar';\r\nimport Landing from './components/landing';\r\n\r\nconst Home: React.FC = () => {\r\n  return (\r\n    <Box>\r\n      <AppBar position='fixed' sx={{ zIndex: (theme) => theme.zIndex.drawer + 1 }}>\r\n        <Topbar/>\r\n      </AppBar>\r\n      <Box component='main'>\r\n        <Toolbar />\r\n        <Landing />\r\n      </Box>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default Home;\r\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\n\r\nimport {\r\n  Box,\r\n  ImageListItemBar\r\n} from '@material-ui/core';\r\nimport { ItemProps } from './VirtualGrid';\r\nimport { VisiblePart, VisiblePartHandler } from '../..';\r\n\r\nconst size = 220;\r\n\r\ninterface GridItem {\r\n  file: gapi.client.drive.File;\r\n  counter: number;\r\n  onImageError?: () => void;\r\n  subVisiblePart?: (cb: VisiblePartHandler) => void;\r\n  onMoveVisible?: (left: number, top: number) => void;\r\n}\r\n\r\ntype ThumbnailProps = ItemProps<GridItem>;\r\n\r\nexport const itemToKey = (item: GridItem) => item.file.id || item.counter;\r\n\r\nconst ThumbnailInner: React.FC<ThumbnailProps> = (props) => {\r\n  const {\r\n    item,\r\n    isActive,\r\n    onClick,\r\n  } = props;\r\n\r\n  const {\r\n    file,\r\n    counter,\r\n    onImageError,\r\n    subVisiblePart,\r\n    onMoveVisible,\r\n  } = item;\r\n\r\n  const [ visiblePart, setVisiblePart ] = useState<VisiblePart>({\r\n    width: 1,\r\n    height: 1,\r\n    left: 0,\r\n    top: 0,\r\n  });\r\n  const [ isGrabbing, setGrabbing ] = useState(false);\r\n\r\n  const onVisiblePartChanged = useCallback((visiblePart: VisiblePart) => {\r\n    if (!isGrabbing) {\r\n      requestAnimationFrame(() => {\r\n        setVisiblePart(visiblePart);\r\n      });\r\n    }\r\n  }, [\r\n    isGrabbing,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (isActive && subVisiblePart) {\r\n      return subVisiblePart(onVisiblePartChanged);\r\n    }\r\n  }, [\r\n    isActive,\r\n    subVisiblePart,\r\n    onVisiblePartChanged,\r\n  ]);\r\n\r\n  const {\r\n    widthPart,\r\n    heightPart\r\n  } = useMemo(() => {\r\n    let widthPart = 1;\r\n    let heightPart = 1;\r\n    if (!isActive || !file.imageMediaMetadata ||\r\n      !file.imageMediaMetadata.width ||\r\n      !file.imageMediaMetadata.height\r\n    ) {\r\n      return {\r\n        widthPart,\r\n        heightPart\r\n      };\r\n    } else {\r\n      if (file.imageMediaMetadata.width < file.imageMediaMetadata.height) {\r\n        widthPart = file.imageMediaMetadata.width /\r\n          file.imageMediaMetadata.height;\r\n      } else {\r\n        heightPart = file.imageMediaMetadata.height /\r\n          file.imageMediaMetadata.width;\r\n      }\r\n      return {\r\n        widthPart,\r\n        heightPart\r\n      }\r\n    }\r\n  }, [\r\n    isActive,\r\n    file.imageMediaMetadata\r\n  ]);\r\n\r\n  const onMouseDown = useCallback(() => {\r\n    setGrabbing(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      if (!isActive || !isGrabbing || !onMoveVisible) {\r\n        return;\r\n      }\r\n      requestAnimationFrame(() => {\r\n        setVisiblePart(current => {\r\n          let {\r\n            width,\r\n            height,\r\n            left,\r\n            top\r\n          } = current;\r\n  \r\n          left = e.movementX < 0 ?\r\n            Math.max(0, left + e.movementX / size) :\r\n            Math.min(1 - width, left + e.movementX / size);\r\n          top = e.movementY < 0 ?\r\n            Math.max(0, top + e.movementY / size) :\r\n            Math.min(1 - height, top + e.movementY / size);\r\n          if (current.left !== left || current.top !== top) {\r\n            onMoveVisible(left, top);\r\n            return {\r\n              ...current,\r\n              left,\r\n              top,\r\n            };\r\n          } else {\r\n            return current;\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    return () => document.removeEventListener('mousemove', onMouseMove);\r\n  }, [\r\n    isActive,\r\n    isGrabbing,\r\n    onMoveVisible,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const onMouseUp = () => setGrabbing(false);\r\n\r\n    if (isActive) {\r\n      document.addEventListener('mouseup', onMouseUp);\r\n      document.addEventListener('mouseleave', onMouseUp);\r\n      document.addEventListener('mouseout', onMouseUp);\r\n      return () => {\r\n        document.removeEventListener('mouseup', onMouseUp);\r\n        document.removeEventListener('mouseleave', onMouseUp);\r\n        document.removeEventListener('mouseout', onMouseUp);\r\n      }\r\n    }\r\n  }, [\r\n    isActive,\r\n  ]);\r\n\r\n  const {\r\n    left,\r\n    top,\r\n    width,\r\n    height,\r\n  } = useMemo(() => {\r\n    const left = (1 - widthPart) / 2 +\r\n      visiblePart.left * widthPart;\r\n    const top = (1 - heightPart) / 2 +\r\n      visiblePart.top * heightPart;\r\n    const width = widthPart * visiblePart.width;\r\n    const height = heightPart * visiblePart.height;\r\n    return {\r\n      left,\r\n      top,\r\n      width,\r\n      height,\r\n    };\r\n  }, [\r\n    widthPart,\r\n    heightPart,\r\n    visiblePart\r\n  ]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        height: `${size}px`,\r\n        width: `${size}px`,\r\n        borderRadius: '6px',\r\n        boxSizing: 'border-box',\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        ...(isActive ?\r\n          {\r\n            bgcolor: 'common.black'\r\n          } :\r\n          {\r\n            border: '1px solid #dadce0',\r\n            cursor: 'pointer',\r\n          }\r\n        )\r\n      }}\r\n      onClick={onClick}\r\n    >\r\n      <Box\r\n        component={'img'}\r\n        src={file.thumbnailLink}\r\n        alt={file.name}\r\n        onError={onImageError}\r\n        sx={{\r\n          position: 'absolute',\r\n          top: '50%',\r\n          left: '50%',\r\n          transform: 'translate(-50%, -50%)',\r\n        }}\r\n      />\r\n      {(isActive && (visiblePart.width < 1 || visiblePart.height < 1)) ?\r\n        <>\r\n          <Box\r\n            sx={{\r\n              position: 'absolute',\r\n              top: '0',\r\n              right: '0',\r\n              bottom: '0',\r\n              left: '0',\r\n              background: 'rgba(0, 0, 0, 0.5)',\r\n              clipPath: `polygon(0% 0%, 0% 100%, ${\r\n                left * 100}% 100%, ${\r\n                left * 100}% ${top * 100}%, ${\r\n                (left + width) * 100}% ${top * 100}%, ${\r\n                (left + width) * 100}% ${(top + height) * 100}%, ${\r\n                left * 100}% ${(top + height) * 100}%, ${\r\n                left * 100}% 100%, 100% 100%, 100% 0%)`,\r\n            }}\r\n          >\r\n            <ImageListItemBar\r\n              title={file.name}\r\n              subtitle={`#${counter}`}\r\n              sx={{\r\n                background: 'transparent',\r\n              }}\r\n            />\r\n          </Box>\r\n          <Box\r\n            component={'div'}\r\n            onMouseDown={onMouseDown}\r\n            sx={{\r\n              position: 'absolute',\r\n              left: `${left * 100}%`,\r\n              top: `${top * 100}%`,\r\n              width: `${width * 100}%`,\r\n              height: `${height * 100}%`,\r\n              cursor: isGrabbing ? 'grabbing' : 'grab',\r\n              border: '2px solid white',\r\n              boxSizing: 'border-box',\r\n            }}\r\n          />\r\n        </> :\r\n        <ImageListItemBar\r\n          title={file.name}\r\n          subtitle={`#${counter}`}\r\n          sx={{\r\n            ...(!isActive &&\r\n              {\r\n                background: 'rgba(255, 255, 255, 0.5)',\r\n                [`& .MuiImageListItemBar-titleWrap`]: {\r\n                  color: 'common.black'\r\n                }\r\n              }\r\n            )\r\n          }}\r\n        />\r\n      }\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst Thumbnail = React.memo(ThumbnailInner,\r\n  (prevProps, nextProps) => {\r\n    const areEqual = (\r\n      (prevProps.item.file.id === nextProps.item.file.id) &&\r\n      (prevProps.item.counter === nextProps.item.counter) &&\r\n      (prevProps.isActive === nextProps.isActive)\r\n    );\r\n    return areEqual;\r\n  }\r\n);\r\n\r\n\r\nexport default Thumbnail;\r\n","import React, {\r\n  useCallback,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  forwardRef,\r\n  useMemo\r\n} from 'react'\r\nimport { useRectSize, useScroll } from './hooks';\r\nimport {\r\n  Box,\r\n} from '@material-ui/core';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system';\r\n\r\ntype ScrollToBlock = 'center' | 'smart';\r\n\r\nexport interface VirtualGridRef {\r\n  scrollToIndex: (index: number, block?:  ScrollToBlock) => void;\r\n}\r\n\r\nexport interface ItemProps<Item> {\r\n  item: Item;\r\n  isActive: boolean;\r\n  onClick: () => void;\r\n}\r\n\r\ninterface VirtualGridProps<Item> {\r\n  items: Item[];\r\n  itemHeight: number;\r\n  itemWidth?: number;\r\n  ItemElement: React.FC<ItemProps<Item>>;\r\n  itemToKey: (item: Item) => React.Key;\r\n  activeIndex: number;\r\n  onActive: (index: number) => void;\r\n  scrollToIndex?: number;\r\n  onVisibleRows?: (rows: number[]) => void;\r\n  numColumns?: number;\r\n  center?: boolean;\r\n  sx?: SystemStyleObject;\r\n}\r\n\r\nconst columnGap = 4;\r\nconst rowGap = 4;\r\nconst scrollBarWidth = 20;\r\nconst rowsAhead = 1;\r\n\r\nconst VirtualGridInner = <Item,>(\r\n  props: VirtualGridProps<Item>,\r\n  virtualGridRef?: React.ForwardedRef<VirtualGridRef>\r\n) => {\r\n  const {\r\n    items,\r\n    itemHeight,\r\n    itemWidth,\r\n    ItemElement,\r\n    itemToKey,\r\n    activeIndex,\r\n    onActive,\r\n    scrollToIndex,\r\n    onVisibleRows,\r\n    numColumns,\r\n    center,\r\n    sx\r\n  } = props;\r\n\r\n  const {\r\n    ref,\r\n    rectSize\r\n  } = useRectSize();\r\n\r\n  const {\r\n    width,\r\n    height\r\n  } = useMemo(() => ({...rectSize}), [\r\n    rectSize\r\n  ]);\r\n\r\n  const itemsCount = items.length;\r\n\r\n  const itemsInRow = numColumns ?\r\n    numColumns :\r\n    (width && itemWidth) ?\r\n      Math.floor(\r\n        (width + columnGap - scrollBarWidth) /\r\n        (itemWidth + columnGap)\r\n      ) : 1;\r\n\r\n  const rowsCount = Math.ceil(itemsCount / itemsInRow);\r\n\r\n  const {\r\n    scrollTop,\r\n    isScrolling\r\n  }= useScroll(ref);\r\n\r\n  const totalHeight = rowsCount * itemHeight +\r\n    (rowsCount - 1) * rowGap;\r\n  const startRow = Math.max(\r\n    0,\r\n    Math.floor(scrollTop / (itemHeight + rowGap)) - rowsAhead\r\n  );\r\n  const startItem = startRow * itemsInRow;\r\n\r\n  const visibleItemsCount = Math.min(\r\n    itemsCount - startItem,\r\n    (\r\n      rowsAhead + (\r\n        Math.ceil(height / (itemHeight + rowGap)) + 2 * rowsAhead\r\n      ) + rowsAhead\r\n    ) * itemsInRow\r\n  );\r\n\r\n  const offsetY = startRow * (itemHeight + rowGap);\r\n\r\n  const firstVisibleRow = Math.floor(\r\n    (scrollTop) / (itemHeight + rowGap)\r\n  );\r\n  const lastVisibleRow = Math.floor(\r\n    (scrollTop + height) / (itemHeight + rowGap)\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (onVisibleRows) {\r\n      const visibleRows = [] as number[];\r\n      for (let i = firstVisibleRow; i <= lastVisibleRow; i++) {\r\n        visibleRows.push(i);\r\n      }\r\n      onVisibleRows(visibleRows);\r\n    }\r\n  }, [\r\n    firstVisibleRow,\r\n    lastVisibleRow,\r\n    onVisibleRows\r\n  ]);\r\n\r\n  const visibleItems = useMemo(() => items\r\n    .slice(startItem, startItem + visibleItemsCount)\r\n    .map((item, i) => (\r\n      <ItemElement\r\n        key={itemToKey(item)}\r\n        item={item}\r\n        isActive={startItem + i === activeIndex}\r\n        onClick={() => {\r\n          onActive(startItem + i)\r\n        }}\r\n      />\r\n    )),[\r\n      ItemElement,\r\n      activeIndex,\r\n      itemToKey,\r\n      items,\r\n      onActive,\r\n      startItem,\r\n      visibleItemsCount\r\n  ]);\r\n\r\n  const gridTemplateColumns = width ?\r\n    `repeat(${itemsInRow}, ${itemWidth}px)` :\r\n    `repeat(auto-fill, ${itemWidth}px)`;\r\n\r\n  const doScrollToIndex = useCallback(\r\n    (scrollToIndex: number, block = 'center') => {\r\n      // console.log('doScrollToIndex', {scrollToIndex, block});\r\n      const scrollToRow = scrollToIndex &&\r\n        Math.floor(scrollToIndex / itemsInRow);\r\n      let scrollOffset = 0;\r\n      if (block === 'smart') {\r\n        const scrollToRowTop = scrollToRow &&\r\n          Math.ceil(scrollToRow * (itemHeight + rowGap));\r\n        const scrollToRowBottom = scrollToRowTop + itemHeight;\r\n        const scrollBottom = scrollTop + height;\r\n\r\n        // console.log({scrollToRowTop, scrollBottom, height, itemHeight});\r\n\r\n        if (scrollToRowTop >= scrollTop && scrollToRowBottom <= scrollBottom) {\r\n          return scrollTop;\r\n        } else if (scrollToRowBottom > scrollTop && scrollToRowTop < scrollTop) {\r\n          scrollOffset = 0\r\n        } else if (scrollToRowTop < scrollBottom && scrollToRowBottom > scrollBottom) {\r\n          scrollOffset = height - itemHeight;\r\n        }\r\n      } else {\r\n        scrollOffset = Math.ceil(height / 2 - itemHeight / 2);\r\n      }\r\n      const scrollTo = scrollToIndex && scrollToRow &&\r\n        Math.ceil(scrollToRow * (itemHeight + rowGap)) -\r\n          scrollOffset;\r\n          \r\n      if (ref.current) {\r\n        const div = ref.current;\r\n        div.scroll(0, scrollTo);\r\n      }\r\n  }, [\r\n    ref,\r\n    height,\r\n    itemHeight,\r\n    itemsInRow,\r\n    scrollTop\r\n  ]);\r\n\r\n  useImperativeHandle(virtualGridRef, () => ({\r\n    scrollToIndex(index: number, block = 'center') {\r\n      doScrollToIndex(index, block);\r\n    }\r\n  }), [\r\n    doScrollToIndex\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (scrollToIndex !== undefined) {\r\n      doScrollToIndex(scrollToIndex);\r\n    }\r\n  }, [\r\n    doScrollToIndex,\r\n    scrollToIndex\r\n  ]);\r\n\r\n  return (\r\n    <Box\r\n      component={'div'}\r\n      ref={ref}\r\n      sx={{\r\n        ...sx,\r\n        overflowY: 'auto',\r\n        willChange: 'transform'\r\n      }}\r\n    >\r\n      {width ?\r\n        <Box\r\n          component={'div'}\r\n          sx={{\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n            height: `${totalHeight}px`,\r\n            pointerEvents: isScrolling ? 'none' : undefined\r\n          }}\r\n        >\r\n          <Box\r\n            component={'div'}\r\n            sx={{\r\n              width: '100%',\r\n              position: 'absolute',\r\n              display: 'grid',\r\n              gap: '4px',\r\n              top: `${offsetY}px`,\r\n              gridTemplateColumns,\r\n              ...(center && {\r\n                justifyContent: 'center',\r\n                justifyItems: 'center'\r\n              })\r\n            }}\r\n          >\r\n            {visibleItems}\r\n          </Box>\r\n        </Box> : null\r\n      }\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst VirtualGrid = forwardRef(VirtualGridInner) as <Item>(\r\n  props: VirtualGridProps<Item> & {\r\n    ref?: React.ForwardedRef<VirtualGridRef>\r\n  }\r\n) => ReturnType<typeof VirtualGridInner>;\r\n\r\n\r\nexport default VirtualGrid;\r\n","import React, {useMemo, useRef, useEffect, useCallback} from 'react';\r\nimport Thumbnail, {\r\n  itemToKey\r\n} from './Thumbnail';\r\nimport VirtualGrid, {\r\n   VirtualGridRef\r\n} from './VirtualGrid';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system';\r\nimport { VisiblePartHandler } from '../..';\r\n\r\ninterface ThumbnailsProps {\r\n  files?: gapi.client.drive.File[];\r\n  fileId?: string;\r\n  onSelect: (fileId: string) => void;\r\n  onVisibleFiles?: (indices: number[]) => void;\r\n  onImageError?: () => void;\r\n  subVisiblePart?: (cb: VisiblePartHandler) => void;\r\n  onMoveVisible?: (left: number, top: number) => void;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst Thumbnails: React.FC<ThumbnailsProps> = (props) => {\r\n  const {\r\n    files = [],\r\n    fileId,\r\n    onSelect,\r\n    onVisibleFiles,\r\n    onImageError,\r\n    subVisiblePart,\r\n    onMoveVisible,\r\n    sx\r\n  } = props;\r\n\r\n  const virtualGridRef = useRef<VirtualGridRef>(null);\r\n  const scrollIndexRef = useRef(0);\r\n\r\n  const activeIndex = useMemo(() => {\r\n    if (fileId && files && files.length > 0) {\r\n      return files.findIndex(file => file.id === fileId);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }, [\r\n    fileId,\r\n    files\r\n  ]);\r\n\r\n  const items = useMemo(() => {\r\n    return files.map(\r\n      (file, i) => ({\r\n        file,\r\n        counter: i + 1,\r\n        onImageError,\r\n        subVisiblePart,\r\n        onMoveVisible,\r\n      })\r\n    );\r\n  }, [\r\n    files,\r\n    onImageError,\r\n    subVisiblePart,\r\n    onMoveVisible,\r\n  ]);\r\n  const onActive = useCallback((index: number) => {\r\n    const file = files[index];\r\n    if (virtualGridRef.current && file.id) {\r\n      scrollIndexRef.current = index;\r\n      virtualGridRef.current.scrollToIndex(index, 'smart');\r\n      onSelect(file.id);\r\n    }\r\n  }, [\r\n    files,\r\n    onSelect\r\n  ]);\r\n  useEffect(() => {\r\n    if (virtualGridRef.current && activeIndex !== scrollIndexRef.current) {\r\n      scrollIndexRef.current = activeIndex;\r\n      virtualGridRef.current.scrollToIndex(activeIndex);\r\n    }\r\n  }, [\r\n    activeIndex\r\n  ]);\r\n\r\n  return (\r\n    <VirtualGrid\r\n      items={items}\r\n      ItemElement={Thumbnail}\r\n      itemHeight={220}\r\n      numColumns={1}\r\n      center\r\n      itemToKey={itemToKey}\r\n      sx={sx}\r\n      activeIndex={activeIndex}\r\n      onActive={onActive}\r\n      ref={virtualGridRef}\r\n      onVisibleRows={onVisibleFiles}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Thumbnails;\r\n","import React, {\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useState,\r\n  useMemo\r\n} from 'react';\r\nimport { useAbortSignal } from '../../../../lib/hooks';\r\n\r\ninterface ScrollActionsOptions {\r\n  isDisabled?: boolean;\r\n  wheelCount?: number;\r\n  onScrollOverTop?: () => void;\r\n  onScrollBelowBottom?: () => void;\r\n  isOverflow?: boolean;\r\n};\r\n\r\nconst useScrollActions = (options: ScrollActionsOptions) => {\r\n  const {\r\n    isDisabled,\r\n    wheelCount = 3,\r\n    onScrollOverTop,\r\n    onScrollBelowBottom,\r\n    isOverflow,\r\n  } = options;\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const scrollTopRef = useRef(0);\r\n  const scrollOverTopCountRef = useRef(0);\r\n  const scrollBelowBottomCountRef = useRef(0);\r\n\r\n  const scrollNextSlide = useCallback(() => {\r\n    if (ref.current) {\r\n      const div = ref.current;\r\n      const scrollHeight = div.scrollHeight - div.offsetHeight;\r\n      if (scrollTopRef.current >= scrollHeight && onScrollBelowBottom) {\r\n        onScrollBelowBottom();\r\n      } else {\r\n        const slideSize = Math.max(div.offsetHeight - 50, 50);\r\n        div.scroll(0, scrollTopRef.current + slideSize);\r\n      }\r\n    }\r\n  }, [\r\n    onScrollBelowBottom\r\n  ]);\r\n\r\n\r\n  useEffect(() => {\r\n    const scrollContainer = ref.current;\r\n    if (!scrollContainer) {\r\n      return;\r\n    }\r\n\r\n    const onScroll = (e: Event) => {\r\n      if (!isDisabled) {\r\n        requestAnimationFrame(() => {\r\n          const div = e.target as HTMLDivElement;\r\n          if (div) {\r\n            scrollTopRef.current = +div.scrollTop;\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    scrollContainer.addEventListener('scroll', onScroll);\r\n    return () => scrollContainer.removeEventListener('scroll', onScroll);\r\n  }, [\r\n    isDisabled\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const scrollContainer = ref.current;\r\n    if (!scrollContainer || isDisabled) {\r\n      return;\r\n    }\r\n\r\n    const onWheel = (e: WheelEvent) => {\r\n      const div = ref.current;\r\n      if (isOverflow || e.shiftKey || e.ctrlKey) {\r\n        return;\r\n      }\r\n      if (div) {\r\n        const scrollHeight = div.scrollHeight - div.offsetHeight;\r\n        if (e.deltaY < 0) {\r\n          scrollBelowBottomCountRef.current = 0;\r\n          if (scrollTopRef.current <= 0) {\r\n            scrollOverTopCountRef.current += 1;\r\n          }\r\n          if (onScrollOverTop) {\r\n            if (\r\n              scrollHeight <= 0 ||\r\n              scrollOverTopCountRef.current >= wheelCount\r\n            ) {\r\n              scrollOverTopCountRef.current = 0;\r\n              onScrollOverTop();\r\n            }\r\n          }\r\n        }\r\n        if (e.deltaY > 0) {\r\n          scrollOverTopCountRef.current = 0;\r\n          if (scrollTopRef.current >= scrollHeight) {\r\n            scrollBelowBottomCountRef.current += 1;\r\n          }\r\n          if (onScrollBelowBottom) {\r\n            if (\r\n              scrollHeight <= 0 ||\r\n              scrollBelowBottomCountRef.current >= wheelCount\r\n            ) {\r\n              scrollBelowBottomCountRef.current = 0;\r\n              onScrollBelowBottom();\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    scrollContainer.addEventListener('wheel', onWheel);\r\n    return () => scrollContainer.removeEventListener('wheel', onWheel);\r\n  }, [\r\n    isDisabled,\r\n    wheelCount,\r\n    onScrollOverTop,\r\n    onScrollBelowBottom,\r\n    isOverflow,\r\n  ]);\r\n\r\n  return {\r\n    ref,\r\n    scrollNextSlide\r\n  };\r\n};\r\n\r\nexport type ZoomSetter = (current: number) => number;\r\nconst zoomScale = 5;\r\nconst sliderScale = (sliderValue: number) => \r\n  Math.round(100 * zoomScale ** sliderValue);\r\nconst zoomToValue = (zoom: number) =>\r\n  Math.log(zoom / 100) / Math.log(zoomScale);\r\n\r\nconst useZoom = () => {\r\n  const [ sliderValue, setSliderValue ] = useState(0);\r\n  const signal = useAbortSignal();\r\n\r\n  const onSliderChange = useCallback((event: Event, value: number | number[]) => {\r\n    requestAnimationFrame(() => {\r\n      if (!Array.isArray(value) && !signal.aborted) {\r\n        setSliderValue(value);\r\n      }\r\n    });\r\n  }, [\r\n    signal.aborted\r\n  ]);\r\n  const onZoomMinus = useCallback(() => {\r\n    setSliderValue(current => Math.max(-1, current - 1 / zoomScale));\r\n  }, []);\r\n  const onZoomPlus = useCallback(() => {\r\n    setSliderValue(current => Math.min(1, current + 1 / zoomScale));\r\n  }, []);\r\n  const zoom = useMemo(() => {\r\n    return sliderScale(sliderValue);\r\n  }, [\r\n    sliderValue,\r\n  ]);\r\n  const setZoom = useCallback((setter: ZoomSetter) => {\r\n    setSliderValue(currentValue => {\r\n      const currentZoom = sliderScale(currentValue);\r\n      const newZoom = setter(currentZoom);\r\n      const newValue = zoomToValue(newZoom);\r\n      return newValue > currentValue ?\r\n        Math.min(1, newValue) :\r\n        Math.max(-1, newValue);\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    sliderValue,\r\n    sliderScale,\r\n    onSliderChange,\r\n    onZoomMinus,\r\n    onZoomPlus,\r\n    zoom,\r\n    setZoom,\r\n  };\r\n};\r\n\r\nconst swipeThreshold = 60;\r\nconst androidMagicOffset = 5;\r\n\r\ninterface SwipeActionsOptions {\r\n  ref?: React.RefObject<HTMLDivElement>;\r\n  onSwipeLeft?: () => void;\r\n  onSwipeRight?: () => void;\r\n};\r\n\r\nconst useSwipeActions = (options: SwipeActionsOptions) => {\r\n  const {\r\n    ref,\r\n    onSwipeLeft,\r\n    onSwipeRight\r\n  } = options;\r\n  const touchRef = useRef<Touch | undefined>();\r\n  const scrollLeftRef = useRef<number | undefined>();\r\n  const scrollWidthRef = useRef<number | undefined>();\r\n\r\n  useEffect(() => {\r\n    const scrollContainer = ref?.current;\r\n    if (!scrollContainer) {\r\n      return;\r\n    }\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      if (e.touches.length === 1 && !touchRef.current) {\r\n        touchRef.current = e.touches[0];\r\n        scrollLeftRef.current = scrollContainer.scrollLeft;\r\n        scrollWidthRef.current = scrollContainer.scrollWidth - scrollContainer.offsetWidth;\r\n      }\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      if (\r\n        e.changedTouches.length === 1 &&\r\n        touchRef.current &&\r\n        touchRef.current.identifier === e.changedTouches[0].identifier &&\r\n        scrollLeftRef.current !== undefined &&\r\n        scrollWidthRef.current !== undefined\r\n      ) {\r\n        const deltaX = e.changedTouches[0].clientX - touchRef.current.clientX;\r\n        const deltaY = e.changedTouches[0].clientY - touchRef.current.clientY;\r\n        const scrollLeft = scrollLeftRef.current;\r\n        const scrollWidth = scrollWidthRef.current;\r\n        touchRef.current = undefined;\r\n        scrollLeftRef.current = undefined;\r\n        scrollWidthRef.current = undefined;\r\n\r\n        if (Math.abs(deltaX) > Math.abs(deltaY)) {\r\n          if (\r\n            deltaX < -swipeThreshold &&\r\n            scrollLeft >= scrollWidth - androidMagicOffset &&\r\n            onSwipeLeft\r\n          ) {\r\n            onSwipeLeft();\r\n          }\r\n          if (\r\n            deltaX > swipeThreshold &&\r\n            scrollLeft <= 0 &&\r\n            onSwipeRight\r\n          ) {\r\n            onSwipeRight();\r\n          }\r\n        }\r\n      } else {\r\n        touchRef.current = undefined;\r\n      }\r\n    };\r\n\r\n    scrollContainer.addEventListener('touchstart', onTouchStart);\r\n    scrollContainer.addEventListener('touchend', onTouchEnd);\r\n    return () => {\r\n      scrollContainer.removeEventListener('touchstart', onTouchStart);\r\n      scrollContainer.removeEventListener('touchend', onTouchEnd);\r\n    };\r\n  }, [\r\n    ref,\r\n    onSwipeLeft,\r\n    onSwipeRight\r\n  ]);\r\n};\r\n\r\ninterface TouchScrollOptions {\r\n  width: number;\r\n  gap: number;\r\n  ref: React.RefObject<HTMLDivElement>;\r\n  activeIndex: number;\r\n  contentHash?: string;\r\n  isEnabled?: boolean;\r\n  onPrevImage?: () => void;\r\n  onNextImage?: () => void;\r\n};\r\n\r\nconst useTouchScroll = (options: TouchScrollOptions) => {\r\n  const {\r\n    width,\r\n    gap,\r\n    ref,\r\n    activeIndex,\r\n    contentHash,\r\n    isEnabled,\r\n    onPrevImage,\r\n    onNextImage,\r\n  } = options;\r\n\r\n  useEffect(() => {\r\n    if (isEnabled && width &&\r\n      ref.current\r\n    ) {\r\n      const scrollContainer = ref.current;\r\n      scrollContainer.scrollLeft = (width + 20) * activeIndex;\r\n    }\r\n  }, [\r\n    isEnabled,\r\n    width,\r\n    ref,\r\n    activeIndex,\r\n    contentHash\r\n  ]);\r\n\r\n  const isSwipeLockedRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    const onScroll = (e: Event) => {\r\n      const div = e.target as HTMLDivElement;\r\n      if (div) {\r\n        if (!isSwipeLockedRef.current) {\r\n          const current = div.scrollLeft / (width + gap);\r\n          if (Math.ceil(current) < activeIndex && onPrevImage) {\r\n            isSwipeLockedRef.current = true;\r\n            onPrevImage();\r\n          }\r\n          if (Math.floor(current) > activeIndex && onNextImage) {\r\n            isSwipeLockedRef.current = true;\r\n            onNextImage();\r\n          }\r\n        } else {\r\n          isSwipeLockedRef.current = false;\r\n        }\r\n      }\r\n    };\r\n\r\n    if (isEnabled && width &&\r\n      ref.current\r\n    ) {\r\n      const scrollContainer = ref.current;\r\n      scrollContainer.addEventListener('scroll', onScroll);\r\n      return () => scrollContainer.removeEventListener('scroll', onScroll);\r\n    }\r\n  }, [\r\n    isEnabled,\r\n    width,\r\n    gap,\r\n    ref,\r\n    activeIndex,\r\n    onPrevImage,\r\n    onNextImage,\r\n    contentHash,\r\n  ]);\r\n};\r\n\r\nexport {\r\n  useScrollActions,\r\n  useZoom,\r\n  useSwipeActions,\r\n  useTouchScroll\r\n}\r\n","import React from 'react';\r\nimport {\r\n  SystemStyleObject,\r\n} from '@material-ui/system';\r\nimport {\r\n  Stack,\r\n  IconButton,\r\n  Slider,\r\n} from '@material-ui/core';\r\nimport ZoomMinusIcon from '@material-ui/icons/Remove';\r\nimport ZoomPlusIcon from '@material-ui/icons/Add';\r\n\r\ninterface ZoomSliderProps {\r\n  sliderValue: number;\r\n  onSliderChange: (event: Event, value: number | number[]) => void;\r\n  sliderScale: (value: number) => number;\r\n  onZoomMinus: () => void;\r\n  onZoomPlus: () => void;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst ZoomSlider: React.FC<ZoomSliderProps> = (props) => {\r\n  const {\r\n    sliderValue,\r\n    onSliderChange,\r\n    sliderScale,\r\n    onZoomMinus,\r\n    onZoomPlus,\r\n    sx\r\n  } = props;\r\n\r\n  return (\r\n    <Stack\r\n      spacing={1}\r\n      direction='row'\r\n      alignItems='center'\r\n      sx={{\r\n        position: 'absolute',\r\n        left: '50%',\r\n        transform: 'translate(-50%,0)',\r\n        bottom: {\r\n          xs: '60px',\r\n          md: '20px',\r\n        },\r\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n        width: '200px',\r\n        zIndex: 1,\r\n        ...sx,\r\n      }}\r\n    >\r\n      <IconButton\r\n        onClick={onZoomMinus}\r\n      >\r\n        <ZoomMinusIcon\r\n          color={'primary'}\r\n        />\r\n      </IconButton>\r\n      <Slider\r\n        value={sliderValue}\r\n        onChange={onSliderChange}\r\n        step={0.00000001}\r\n        min={-1}\r\n        max={1}\r\n        valueLabelDisplay='auto'\r\n        scale={sliderScale}\r\n      />\r\n      <IconButton\r\n        onClick={onZoomPlus}\r\n      >\r\n        <ZoomPlusIcon\r\n          color={'primary'}\r\n        />\r\n      </IconButton>\r\n    </Stack>\r\n  );\r\n};\r\n\r\nexport default ZoomSlider;\r\n","import React, { } from 'react';\r\nimport {\r\n  SystemStyleObject,\r\n} from '@material-ui/system';\r\nimport {\r\n  keyframes\r\n} from '@emotion/react';\r\nimport {\r\n  Box\r\n} from '@material-ui/core';\r\n\r\nconst pulseKeyframe = keyframes`\r\n  0% {\r\n    opacity: 1;\r\n  }\r\n  50% {\r\n    opacity: 0.4;\r\n  }\r\n  100% {\r\n    opacity: 1;\r\n  }\r\n`;\r\n\r\ninterface ImageSkeletonProps {\r\n  width: number;\r\n  height: number;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst ImageSkeleton: React.FC<ImageSkeletonProps> = (props) => {\r\n  const {\r\n    width,\r\n    height,\r\n    sx,\r\n  } = props;\r\n\r\n  return (\r\n    <Box\r\n      component='svg'\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      viewBox={`0 0 ${width} ${height}`}\r\n      sx={{\r\n        bgcolor: 'grey.900',\r\n        animation: `${pulseKeyframe} 1.5s ease-in-out 0.5s infinite`,\r\n        width: `${width}px`,\r\n        height: `${height}px`,\r\n        ...sx,\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default ImageSkeleton;\r\n","import React, { \r\n  useEffect,\r\n  useMemo,\r\n  useRef,\r\n  useState,\r\n  forwardRef,\r\n  useImperativeHandle,\r\n} from 'react';\r\nimport {\r\n  SystemStyleObject,\r\n} from '@material-ui/system';\r\nimport {\r\n  Box\r\n} from '@material-ui/core';\r\nimport { FitMode, VisiblePart } from '../..';\r\nimport { RectSize } from '../thumbnails/hooks';\r\nimport {\r\n  useScrollActions,\r\n  ZoomSetter\r\n} from '../viewer/hooks';\r\nimport ImageSkeleton from '../image-skeleton';\r\nimport { useBrowserScrollbarWidth } from '../../../../lib/hooks';\r\n\r\nconst wheelCount = 3;\r\nconst slideShowInterval = 5000;\r\nconst zoomStep = 0.4;\r\n\r\ninterface FixedPoint {\r\n  localZoom: number;\r\n  offsetX: number;\r\n  offsetY: number;\r\n  scrollX: number;\r\n  scrollY: number;\r\n}\r\n\r\nexport interface ImageScreenRef {\r\n  scrollVisibleTo: (left: number, top: number) => void;\r\n}\r\n\r\ninterface ImageScreenProps {\r\n  file?: gapi.client.drive.File;\r\n  containerRectSize: RectSize,\r\n  fitMode?: FitMode;\r\n  zoom?: number;\r\n  isSlideshowPlaying?: boolean;\r\n  isScrollDisabled?: boolean;\r\n  onPrevImage?: () => void;\r\n  onNextImage?: () => void;\r\n  onImageError?: () => void;\r\n  isPreload?: boolean;\r\n  onOverflowChanged?: (isOverflow: boolean) => void;\r\n  setZoom?: (setter: ZoomSetter) => void;\r\n  onVisibleChange?: (options: VisiblePart) => void;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst ImageScreen = forwardRef<ImageScreenRef, ImageScreenProps>(\r\n  (props, imageScreenRef) => {\r\n  const {\r\n    file,\r\n    containerRectSize,\r\n    fitMode,\r\n    zoom = 100,\r\n    isSlideshowPlaying,\r\n    isScrollDisabled,\r\n    onPrevImage,\r\n    onNextImage,\r\n    onImageError,\r\n    isPreload,\r\n    onOverflowChanged,\r\n    setZoom,\r\n    onVisibleChange,\r\n    sx,\r\n  } = props;\r\n\r\n  const [ localZoom, setLocalZoom ] = useState(0);\r\n  const modeZoomRef = useRef(zoom);\r\n  const scrollbarWidth = useBrowserScrollbarWidth();\r\n  const isOferflowRef = useRef(false);\r\n\r\n  const {\r\n    ref,\r\n    scrollNextSlide,\r\n  } = useScrollActions({\r\n    isDisabled: isScrollDisabled,\r\n    wheelCount,\r\n    onScrollOverTop: onPrevImage,\r\n    onScrollBelowBottom: onNextImage,\r\n    isOverflow: isOferflowRef.current,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (isSlideshowPlaying) {\r\n      const timer = setInterval(scrollNextSlide, slideShowInterval);\r\n      return () => {\r\n        clearInterval(timer);\r\n      };\r\n    }\r\n  }, [\r\n    isSlideshowPlaying,\r\n    scrollNextSlide\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (!file || !file.imageMediaMetadata ||\r\n      !file.imageMediaMetadata.width ||\r\n      !file.imageMediaMetadata.height ||\r\n      !containerRectSize.width ||\r\n      !containerRectSize.height\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const imageWidth = file.imageMediaMetadata.width;\r\n    const imageHeight = file.imageMediaMetadata.height;\r\n    const {\r\n      width,\r\n      height\r\n    } = containerRectSize;\r\n\r\n    if (fitMode === FitMode.Best) {\r\n      const horizontalScale = (imageWidth > width) ?\r\n        width / imageWidth : 1;\r\n      const verticalScale = (imageHeight > height) ?\r\n        height / imageHeight : 1;\r\n      const scale = Math.min(horizontalScale, verticalScale);\r\n      modeZoomRef.current = scale * 100;\r\n    } else if (fitMode === FitMode.Width) {\r\n      let scale = 1;\r\n      if (imageWidth > width) {\r\n        scale = width / imageWidth;\r\n        const scaledHeight = imageHeight * scale;\r\n        if (scaledHeight > height && width > scrollbarWidth) {\r\n          scale = (width - scrollbarWidth) / imageWidth;\r\n        }\r\n      }\r\n      modeZoomRef.current = scale * 100;\r\n    } else if (fitMode === FitMode.Height) {\r\n      let scale = 1;\r\n      if (imageHeight > height) {\r\n        scale = height / imageHeight;\r\n        const scaledWidth = imageWidth * scale;\r\n        if (scaledWidth > width && height > scrollbarWidth) {\r\n          scale = (height - scrollbarWidth) / imageHeight;\r\n        }\r\n      }\r\n      modeZoomRef.current = scale * 100;\r\n    } else if (fitMode === FitMode.Original) {\r\n      let scale = 1;\r\n      modeZoomRef.current = scale * 100;\r\n    } else if (fitMode === FitMode.Manual) {\r\n      modeZoomRef.current = zoom;\r\n    }\r\n    setLocalZoom(modeZoomRef.current);\r\n  }, [\r\n    containerRectSize,\r\n    file,\r\n    fitMode,\r\n    scrollbarWidth,\r\n    zoom,\r\n  ]);\r\n\r\n  const {\r\n    imageWidth,\r\n    imageHeight,\r\n    left,\r\n    top,\r\n  } = useMemo(() => {\r\n    if (!file || !file.imageMediaMetadata ||\r\n      !file.imageMediaMetadata.width ||\r\n      !file.imageMediaMetadata.height ||\r\n      !containerRectSize.width ||\r\n      !containerRectSize.height\r\n    ) {\r\n      return {\r\n        imageWidth: 0,\r\n        imageHeight: 0,\r\n        left: 0,\r\n        top: 0,\r\n      };\r\n    } else {\r\n      const imageWidth = Math.round(\r\n        file.imageMediaMetadata.width * localZoom / 100\r\n      );\r\n      const imageHeight = Math.round(\r\n        file.imageMediaMetadata.height * localZoom / 100\r\n      );\r\n      const isHorizontalScroll = imageWidth > containerRectSize.width;\r\n      const isVerticalScroll = imageHeight > containerRectSize.height;\r\n      const clientWidth = isVerticalScroll ?\r\n        containerRectSize.width - scrollbarWidth :\r\n        containerRectSize.width;\r\n      const clientHeight = isHorizontalScroll ?\r\n        containerRectSize.height - scrollbarWidth :\r\n        containerRectSize.height;\r\n      const left = imageWidth < clientWidth ?\r\n        (clientWidth - imageWidth) / 2 : 0;\r\n      const top = imageHeight < clientHeight ?\r\n        (clientHeight - imageHeight) / 2 : 0;\r\n      return {\r\n        imageWidth,\r\n        imageHeight,\r\n        left,\r\n        top,\r\n      };\r\n    }\r\n  }, [\r\n    containerRectSize.width,\r\n    containerRectSize.height,\r\n    file,\r\n    localZoom,\r\n    scrollbarWidth,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (imageWidth && containerRectSize.width) {\r\n      isOferflowRef.current = imageWidth > containerRectSize.width;\r\n      if (onOverflowChanged) {\r\n        onOverflowChanged(isOferflowRef.current);\r\n      }\r\n    }\r\n  }, [\r\n    onOverflowChanged,\r\n    imageWidth,\r\n    containerRectSize.width\r\n  ]);\r\n\r\n  const fixedPointRef = useRef<FixedPoint | null>(null);\r\n  useEffect(() => {\r\n    const div = ref.current;\r\n    if (!div) {\r\n      return;\r\n    }\r\n\r\n    const saveFixedPoint = (e: WheelEvent, localZoom: number) => {\r\n      fixedPointRef.current = {\r\n        localZoom,\r\n        offsetX: e.offsetX,\r\n        offsetY: e.offsetY,\r\n        scrollX: div.scrollLeft,\r\n        scrollY: div.scrollTop,\r\n      };\r\n    };\r\n\r\n    const onWheel = (e: WheelEvent) => {\r\n      if (!e.ctrlKey) {\r\n        return;\r\n      } else {\r\n        e.preventDefault();\r\n      }\r\n\r\n      const zoomSetter = (fitMode === FitMode.Manual && setZoom) ?\r\n        setZoom : setLocalZoom;\r\n      const minLocalZoom = (fitMode === FitMode.Manual) ?\r\n        0 : modeZoomRef.current;\r\n      const maxLocalZoom = (fitMode === FitMode.Manual) ?\r\n        Infinity : 100;\r\n      zoomSetter(current => {\r\n        const newLocalZoom = (e.deltaY < 0) ?\r\n          Math.min(maxLocalZoom, current * (1 + zoomStep)) :\r\n          Math.max(minLocalZoom, current * (1 - zoomStep));\r\n        if (newLocalZoom !== current) {\r\n          saveFixedPoint(e, current);\r\n        }\r\n        return newLocalZoom;\r\n      })\r\n    };\r\n\r\n    div.addEventListener('wheel', onWheel);\r\n    return () => div.removeEventListener('wheel', onWheel);\r\n  }, [\r\n    ref,\r\n    fitMode,\r\n    setZoom,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const fixedPoint = fixedPointRef.current;\r\n    const div = ref.current;\r\n    if (!fixedPoint || !div || !fixedPoint.localZoom || !localZoom) {\r\n      return;\r\n    }\r\n    const offsetX = fixedPoint.offsetX / fixedPoint.localZoom * localZoom;\r\n    const offsetY = fixedPoint.offsetY / fixedPoint.localZoom * localZoom;\r\n    const scrollX = fixedPoint.scrollX - fixedPoint.offsetX + offsetX;\r\n    const scrollY = fixedPoint.scrollY - fixedPoint.offsetY + offsetY;\r\n    div.scroll(scrollX, scrollY);\r\n    fixedPointRef.current = null;\r\n  }, [\r\n    localZoom,\r\n    ref,\r\n  ]);\r\n\r\n  const touchesRef = useRef<PointerEvent[]>([]);\r\n  const diffRef = useRef(-1);\r\n\r\n  useEffect(() => {\r\n    const div = ref.current;\r\n    if (!div) {\r\n      return;\r\n    }\r\n\r\n    const scrollToFixedPoint = (\r\n      fixedPoint: FixedPoint,\r\n      newLocalZoom: number\r\n    ) => {\r\n      const offsetX = fixedPoint.offsetX / fixedPoint.localZoom * newLocalZoom;\r\n      const offsetY = fixedPoint.offsetY / fixedPoint.localZoom * newLocalZoom;\r\n      const scrollX = fixedPoint.scrollX - fixedPoint.offsetX + offsetX;\r\n      const scrollY = fixedPoint.scrollY - fixedPoint.offsetY + offsetY;\r\n      div.scroll(scrollX, scrollY);\r\n    }\r\n    \r\n    const onPointerDown = (e: PointerEvent) => {\r\n      touchesRef.current.push(e);\r\n    };\r\n\r\n    const onPointerMove = (e: PointerEvent) => {\r\n      for (let i = 0; i < touchesRef.current.length; i++) {\r\n        if (e.pointerId === touchesRef.current[i].pointerId) {\r\n          touchesRef.current[i] = e;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if (touchesRef.current.length === 2) {\r\n        const newDiff = Math.sqrt(\r\n          Math.pow(\r\n            touchesRef.current[0].clientX - touchesRef.current[1].clientX,\r\n            2\r\n          ) + \r\n          Math.pow(\r\n            touchesRef.current[0].clientY - touchesRef.current[1].clientY,\r\n            2\r\n          )\r\n        );\r\n\r\n        const center = {\r\n          offsetX: (\r\n            touchesRef.current[0].offsetX + touchesRef.current[1].offsetX\r\n          ) / 2,\r\n          offsetY: (\r\n            touchesRef.current[0].offsetY + touchesRef.current[1].offsetY\r\n          ) / 2\r\n        }\r\n\r\n        if (diffRef.current && diffRef.current > 0) {\r\n          if (newDiff !== diffRef.current) {\r\n            const zoomSetter = (fitMode === FitMode.Manual && setZoom) ?\r\n              setZoom : setLocalZoom;\r\n            const minLocalZoom = (fitMode === FitMode.Manual) ?\r\n              0 : modeZoomRef.current;\r\n            const maxLocalZoom = (fitMode === FitMode.Manual) ?\r\n              Infinity : 100;\r\n\r\n            zoomSetter(current => {\r\n              const newLocalZoom = (newDiff > diffRef.current) ?\r\n                Math.min(\r\n                  maxLocalZoom,\r\n                  current * newDiff / diffRef.current\r\n                ) : Math.max(\r\n                  minLocalZoom,\r\n                  current * newDiff / diffRef.current\r\n                );\r\n              if (newLocalZoom !== current) {\r\n                const fixedPoint = {\r\n                  localZoom: current,\r\n                  offsetX: center.offsetX,\r\n                  offsetY: center.offsetY,\r\n                  scrollX: div.scrollLeft,\r\n                  scrollY: div.scrollTop,\r\n                };\r\n                if (fitMode !== FitMode.Manual) {\r\n                  scrollToFixedPoint(fixedPoint, newLocalZoom);\r\n                }\r\n              }\r\n              return newLocalZoom;\r\n            });\r\n          }\r\n        }\r\n        diffRef.current = newDiff;\r\n      }\r\n    };\r\n\r\n    const onPointerUp = (e: PointerEvent) => {\r\n      for (let i = 0; i < touchesRef.current.length; i++) {\r\n        if (e.pointerId === touchesRef.current[i].pointerId) {\r\n          touchesRef.current.splice(i, 1);\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (touchesRef.current.length < 2) {\r\n        diffRef.current = -1;\r\n      }\r\n    };\r\n\r\n    div.addEventListener('pointerdown', onPointerDown);\r\n    div.addEventListener('pointermove', onPointerMove);\r\n    div.addEventListener('pointerup', onPointerUp);\r\n    div.addEventListener('pointercancel', onPointerUp);\r\n    div.addEventListener('pointerout', onPointerUp);\r\n    div.addEventListener('pointerleave', onPointerUp);\r\n    return () => {\r\n      div.removeEventListener('pointerdown', onPointerDown);\r\n      div.removeEventListener('pointermove', onPointerMove);\r\n      div.removeEventListener('pointerup', onPointerUp);\r\n      div.removeEventListener('pointercancel', onPointerUp);\r\n      div.removeEventListener('pointerout', onPointerUp);\r\n      div.removeEventListener('pointerleave', onPointerUp);\r\n    };\r\n  }, [\r\n    ref,\r\n    fitMode,\r\n    setZoom,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const div = ref.current;\r\n    if (!div) {\r\n      return;\r\n    }\r\n\r\n    const updateVisible = () => {\r\n      if (onVisibleChange) {\r\n        onVisibleChange({\r\n          width: (\r\n            div.scrollWidth <= div.offsetWidth &&\r\n            div.scrollWidth > 0\r\n          ) ? 1 : div.offsetWidth / div.scrollWidth,\r\n          height: (\r\n            div.scrollHeight <= div.offsetHeight &&\r\n            div.scrollHeight > 0\r\n          ) ? 1 : div.offsetHeight / div.scrollHeight,\r\n          left: (\r\n            div.scrollWidth > 0\r\n          ) ? div.scrollLeft / div.scrollWidth : 0,\r\n          top: (\r\n            div.scrollHeight > 0\r\n          ) ? div.scrollTop / div.scrollHeight : 0,\r\n        });\r\n      }\r\n    };\r\n\r\n    updateVisible();\r\n    div.addEventListener('scroll', updateVisible);\r\n\r\n    return () => {\r\n      div.removeEventListener('scroll', updateVisible);\r\n    };\r\n  }, [\r\n    ref,\r\n    localZoom,\r\n    onVisibleChange,\r\n  ]);\r\n\r\n  useImperativeHandle(imageScreenRef, () => ({\r\n    scrollVisibleTo(left: number, top: number) {\r\n      const div = ref.current;\r\n      if (!div) {\r\n        return;\r\n      }\r\n      div.scrollTo(\r\n        left * div.scrollWidth,\r\n        top * div.scrollHeight\r\n      );\r\n    }\r\n  }), [\r\n    ref,\r\n  ]);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        textAlign: 'center',\r\n        overflow: 'auto',\r\n        whiteSpace: 'nowrap',\r\n        position: 'relative',\r\n        touchAction: 'pan-x pan-y',\r\n        ...sx\r\n      }}\r\n      ref={ref}\r\n    >\r\n      {!!file && localZoom > 0 &&\r\n        <>\r\n          {!isPreload &&\r\n            <ImageSkeleton\r\n              width={imageWidth}\r\n              height={imageHeight}\r\n              sx={{\r\n                position: 'absolute',\r\n                left: `${left}px`,\r\n                top: `${top}px`,\r\n              }}\r\n            />\r\n          }\r\n          <Box\r\n            component={'img'}\r\n            key={file.id}\r\n            src={file.webContentLink}\r\n            alt={file.name}\r\n            onClick={onNextImage}\r\n            onError={onImageError}\r\n            sx={{\r\n              position: 'absolute',\r\n              left: `${left}px`,\r\n              top: `${top}px`,\r\n              height: `${imageHeight}px`,\r\n              width: `${imageWidth}px`,\r\n            }}\r\n          />\r\n        </>\r\n      }\r\n    </Box>\r\n  );\r\n});\r\n\r\nexport default ImageScreen;\r\n","import React, {\r\n  forwardRef,\r\n  useImperativeHandle,\r\n  useCallback,\r\n  useState,\r\n  useRef\r\n} from 'react';\r\nimport {\r\n  SystemStyleObject,\r\n} from '@material-ui/system';\r\nimport {\r\n  Box,\r\n  Menu,\r\n  MenuItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n} from '@material-ui/core';\r\nimport {\r\n  useTouchScroll,\r\n  useZoom\r\n} from './hooks';\r\nimport { FitMode, VisiblePart } from '../..';\r\nimport { useFullScreen, useIsTouchScreen } from '../../../../lib/hooks';\r\nimport FullscreenEnterIcon from '@material-ui/icons/Fullscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport FitBestIcon from '@material-ui/icons/CropDin';\r\nimport FitWidthIcon from '@material-ui/icons/CropPortrait';\r\nimport FitHeightIcon from '@material-ui/icons/CropLandscape';\r\nimport FitOriginalIcon from '@material-ui/icons/CropOriginal';\r\nimport FitManualIcon from '@material-ui/icons/ImageSearch';\r\nimport StartSlideshowIcon from '@material-ui/icons/PlayArrow';\r\nimport EndSlideshowIcon from '@material-ui/icons/Pause';\r\nimport { useDebounce, useRectSize } from '../thumbnails/hooks';\r\nimport ZoomSlider from '../zoom-slider';\r\nimport ImageScreen, { ImageScreenRef } from '../image-screen';\r\n\r\nconst delay = 100;\r\nconst gap = 20;\r\n\r\nexport interface ViewerRef {\r\n  toggleFullscreen: () => void;\r\n  scrollVisibleTo: (left: number, top: number) => void;\r\n}\r\n\r\ninterface ViewerProps {\r\n  fitMode: FitMode;\r\n  fileId: string;\r\n  file?: gapi.client.drive.File;\r\n  canPrev: boolean;\r\n  prevFile?: gapi.client.drive.File;\r\n  canNext: boolean;\r\n  nextFile?: gapi.client.drive.File;\r\n  preloadFiles: gapi.client.drive.File[];\r\n  onNextImage: () => void;\r\n  onPrevImage: () => void;\r\n  onFitModeChange: (fitMode: FitMode) => void;\r\n  sx?: SystemStyleObject;\r\n  isScrollToBottom?: boolean;\r\n  isSlideshowEnabled?: boolean;\r\n  isSlideshowPlaying?: boolean;\r\n  onToggleSlideshowPlaying: () => void;\r\n  onImageError?: () => void;\r\n  onVisibleChange: (options: VisiblePart) => void;\r\n};\r\n\r\ninterface Point {\r\n  x: number;\r\n  y: number;\r\n};\r\n\r\nconst Viewer = forwardRef<ViewerRef, ViewerProps>(\r\n  (props, viewerRef) => {\r\n  const {\r\n    fitMode,\r\n    fileId,\r\n    file,\r\n    canPrev,\r\n    prevFile,\r\n    canNext,\r\n    nextFile,\r\n    preloadFiles,\r\n    onNextImage,\r\n    onPrevImage,\r\n    onFitModeChange,\r\n    sx,\r\n    isScrollToBottom,\r\n    isSlideshowEnabled,\r\n    isSlideshowPlaying,\r\n    onToggleSlideshowPlaying,\r\n    onImageError,\r\n    onVisibleChange,\r\n  } = props;\r\n\r\n  const [ contextMenu, setContextMenu ] = useState<Point | null>(null);\r\n  const isTouchScreen = useIsTouchScreen();\r\n\r\n  const {\r\n    ref: containerRef,\r\n    rectSize: containerRectSize\r\n  } = useRectSize();\r\n\r\n  const [ isOverflow, setOverflow ] = useState(false);\r\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n  const currentImageScreenRef = useRef<ImageScreenRef>(null);\r\n\r\n  useTouchScroll({\r\n    activeIndex: canPrev ? 1 : 0,\r\n    gap,\r\n    ref: scrollContainerRef,\r\n    width: containerRectSize.width,\r\n    contentHash: fileId,\r\n    isEnabled: isTouchScreen,\r\n    onPrevImage,\r\n    onNextImage\r\n  });\r\n  \r\n  const {\r\n    isEnabled,\r\n    isFullscreen,\r\n    toggleFullScreen\r\n  } = useFullScreen();\r\n\r\n  useImperativeHandle(viewerRef, () => ({\r\n    toggleFullscreen() {\r\n      if (isEnabled) {\r\n        toggleFullScreen(containerRef.current);\r\n      }\r\n    },\r\n    scrollVisibleTo(left: number, top: number) {\r\n      if (currentImageScreenRef.current) {\r\n        currentImageScreenRef.current.scrollVisibleTo(left, top);\r\n      }\r\n    }\r\n  }), [\r\n    containerRef,\r\n    isEnabled,\r\n    toggleFullScreen,\r\n  ]);\r\n\r\n  const onContextMenu = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    setContextMenu(\r\n      prev => !prev ?\r\n        {\r\n          x: e.clientX - 2,\r\n          y: e.clientY - 4\r\n        } :\r\n        null\r\n    );\r\n  }, []);\r\n\r\n  const onClose = useCallback(() => {\r\n    setContextMenu(null);\r\n  }, []);\r\n\r\n  const onClickFullscreen = useCallback(() => {\r\n    if (isEnabled) {\r\n      toggleFullScreen(containerRef.current);\r\n    }\r\n    onClose();\r\n  }, [\r\n    isEnabled,\r\n    containerRef,\r\n    toggleFullScreen,\r\n    onClose\r\n  ]);\r\n\r\n  const onClickFitBest = useCallback(() => {\r\n    onFitModeChange(FitMode.Best);\r\n    onClose();\r\n  }, [\r\n    onFitModeChange,\r\n    onClose\r\n  ]);\r\n  const onClickFitWidth = useCallback(() => {\r\n    onFitModeChange(FitMode.Width);\r\n    onClose();\r\n  }, [\r\n    onFitModeChange,\r\n    onClose\r\n  ]);\r\n  const onClickFitHeight = useCallback(() => {\r\n    onFitModeChange(FitMode.Height);\r\n    onClose();\r\n  }, [\r\n    onFitModeChange,\r\n    onClose\r\n  ]);\r\n  const onClickFitOriginal = useCallback(() => {\r\n    onFitModeChange(FitMode.Original);\r\n    onClose();\r\n  }, [\r\n    onFitModeChange,\r\n    onClose\r\n  ]);\r\n  const onClickFitManual = useCallback(() => {\r\n    onFitModeChange(FitMode.Manual);\r\n    onClose();\r\n  }, [\r\n    onFitModeChange,\r\n    onClose\r\n  ]);\r\n  const onClickSlideshow = useCallback(() => {\r\n    onToggleSlideshowPlaying();\r\n    onClose();\r\n  }, [\r\n    onToggleSlideshowPlaying,\r\n    onClose\r\n  ]);\r\n\r\n  const {\r\n    sliderValue,\r\n    sliderScale,\r\n    onSliderChange,\r\n    onZoomMinus,\r\n    onZoomPlus,\r\n    zoom,\r\n    setZoom,\r\n  } = useZoom();\r\n\r\n  const prevDebounced = useDebounce(prevFile, isScrollToBottom ? delay : 0);\r\n  const nextDebounced = useDebounce(nextFile, isScrollToBottom ? 0 : delay);\r\n  const fitModeDebounced = useDebounce(fitMode, delay);\r\n  const zoomDebounced = useDebounce(zoom, delay);\r\n\r\n  return (\r\n    <Box\r\n      sx={{\r\n        ...sx,\r\n        overflow: 'hidden',\r\n        bgcolor: 'common.black',\r\n        position: 'relative'\r\n      }}\r\n      ref={containerRef}\r\n      onContextMenu={onContextMenu}\r\n    >\r\n      <ImageScreen\r\n        sx={{\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n        }}\r\n        file={isScrollToBottom ? prevDebounced : nextDebounced}\r\n        containerRectSize={containerRectSize}\r\n        fitMode={fitModeDebounced}\r\n        zoom={zoomDebounced}\r\n        isScrollDisabled\r\n        isPreload\r\n      />\r\n      <Box\r\n        sx={{\r\n          position: 'absolute',\r\n          left: 0,\r\n          right: 0,\r\n          top: 0,\r\n          bottom: 0,\r\n          bgcolor: 'common.black',\r\n        }}\r\n      />\r\n      <Box\r\n        sx={{\r\n          position: 'absolute',\r\n          left: 0,\r\n          right: 0,\r\n          top: 0,\r\n          bottom: 0,\r\n          ...isOverflow ? {\r\n            overflow: 'hidden'\r\n          } : {\r\n            overflowX: 'scroll',\r\n            overflowY: 'hidden',\r\n            scrollSnapType: 'x mandatory',\r\n            \"::-webkit-scrollbar\": {\r\n              display: \"none\"\r\n            },\r\n          }\r\n        }}\r\n        ref={scrollContainerRef}\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: 'flex',\r\n            height: '100%',\r\n            gap: `${gap}px`,\r\n          }}\r\n        >\r\n          {isTouchScreen && canPrev && \r\n            <ImageScreen\r\n              key={prevFile?.id || 'prev'}\r\n              sx={{\r\n                flex: '1 0 100%',\r\n                scrollSnapAlign: 'center',\r\n              }}\r\n              file={(prevDebounced?.id !== fileId) ?\r\n                prevDebounced : undefined\r\n              }\r\n              containerRectSize={containerRectSize}\r\n              fitMode={fitModeDebounced}\r\n              zoom={zoomDebounced}\r\n              isScrollDisabled\r\n              onImageError={onImageError}\r\n            />\r\n          }\r\n          <ImageScreen\r\n            key={fileId || 'current'}\r\n            sx={{\r\n              flex: '1 0 100%',\r\n              scrollSnapAlign: 'center',\r\n            }}\r\n            file={file}\r\n            containerRectSize={containerRectSize}\r\n            fitMode={fitMode}\r\n            zoom={zoom}\r\n            isSlideshowPlaying={isSlideshowPlaying}\r\n            onPrevImage={onPrevImage}\r\n            onNextImage={onNextImage}\r\n            onImageError={onImageError}\r\n            onOverflowChanged={setOverflow}\r\n            setZoom={setZoom}\r\n            onVisibleChange={onVisibleChange}\r\n            ref={currentImageScreenRef}\r\n          />\r\n          {isTouchScreen && canNext &&\r\n            <ImageScreen\r\n              key={nextFile?.id || 'next'}\r\n              sx={{\r\n                flex: '1 0 100%',\r\n                scrollSnapAlign: 'center',\r\n              }}\r\n              file={(nextDebounced?.id !== fileId) ?\r\n                nextDebounced : undefined\r\n              }\r\n              containerRectSize={containerRectSize}\r\n              fitMode={fitModeDebounced}\r\n              zoom={zoomDebounced}\r\n              isScrollDisabled\r\n              onImageError={onImageError}\r\n            />\r\n          }\r\n          {preloadFiles.map(file => (\r\n            <Box\r\n              component={'img'}\r\n              key={file.id}\r\n              src={file.webContentLink}\r\n              alt={file.name}\r\n              sx={{\r\n                display: 'none'\r\n              }}\r\n            />\r\n          ))}\r\n        </Box>\r\n      </Box>\r\n      <Menu\r\n        container={containerRef.current}\r\n        disableScrollLock={true}\r\n        open={!!contextMenu}\r\n        onClose={onClose}\r\n        anchorReference='anchorPosition'\r\n        anchorPosition={!!contextMenu ?\r\n          {\r\n            top: contextMenu.y,\r\n            left: contextMenu.x\r\n          } :\r\n          undefined\r\n        }\r\n      >\r\n        {isEnabled &&\r\n          <MenuItem\r\n            onClick={onClickFullscreen}\r\n          >\r\n            <ListItemIcon>\r\n              {isFullscreen ?\r\n                <FullscreenExitIcon /> :\r\n                <FullscreenEnterIcon />\r\n              }\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {isFullscreen ?\r\n                'Exit Fullscreen' :\r\n                'Enter Fullscreen'\r\n              }\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        {isSlideshowEnabled &&\r\n          <MenuItem\r\n            onClick={onClickSlideshow}\r\n          >\r\n            <ListItemIcon>\r\n              {isSlideshowPlaying ?\r\n                <EndSlideshowIcon/> :\r\n                <StartSlideshowIcon/>\r\n              }\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {isSlideshowPlaying ?\r\n                'End Slideshow' :\r\n                'Start Slideshow'\r\n              }\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        <MenuItem\r\n          onClick={onClickFitBest}\r\n          sx={{\r\n            backgroundColor: fitMode === FitMode.Best ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitBestIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Best Fit'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={onClickFitWidth}\r\n          sx={{\r\n            backgroundColor: fitMode === FitMode.Width ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitWidthIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Fit Width'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={onClickFitHeight}\r\n          sx={{\r\n            backgroundColor: fitMode === FitMode.Height ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitHeightIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Fit Height'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={onClickFitOriginal}\r\n          sx={{\r\n            backgroundColor: fitMode === FitMode.Original ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitOriginalIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Original Size'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={onClickFitManual}\r\n          sx={{\r\n            backgroundColor: fitMode === FitMode.Manual ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitManualIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Manual Zoom'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n      {fitMode === FitMode.Manual &&\r\n        <ZoomSlider\r\n          sliderValue={sliderValue}\r\n          onSliderChange={onSliderChange}\r\n          sliderScale={sliderScale}\r\n          onZoomMinus={onZoomMinus}\r\n          onZoomPlus={onZoomPlus}\r\n        />\r\n      }\r\n    </Box>\r\n  );\r\n});\r\n\r\nexport default Viewer;\r\n","import { SvgIcon } from '@material-ui/core';\r\nimport React from 'react';\r\n\r\nconst GoogleIcon: React.FC = () => {\r\n  return (\r\n    <SvgIcon\r\n      fontSize={'small'}\r\n    >\r\n      <g transform=\"matrix(1, 0, 0, 1, 27.009001, -39.238998)\">\r\n        <path fill=\"#4285F4\" d=\"M -3.264 51.509 C -3.264 50.719 -3.334 49.969 -3.454 49.239 L -14.754 49.239 L -14.754 53.749 L -8.284 53.749 C -8.574 55.229 -9.424 56.479 -10.684 57.329 L -10.684 60.329 L -6.824 60.329 C -4.564 58.239 -3.264 55.159 -3.264 51.509 Z\"/>\r\n        <path fill=\"#34A853\" d=\"M -14.754 63.239 C -11.514 63.239 -8.804 62.159 -6.824 60.329 L -10.684 57.329 C -11.764 58.049 -13.134 58.489 -14.754 58.489 C -17.884 58.489 -20.534 56.379 -21.484 53.529 L -25.464 53.529 L -25.464 56.619 C -23.494 60.539 -19.444 63.239 -14.754 63.239 Z\"/>\r\n        <path fill=\"#FBBC05\" d=\"M -21.484 53.529 C -21.734 52.809 -21.864 52.039 -21.864 51.239 C -21.864 50.439 -21.724 49.669 -21.484 48.949 L -21.484 45.859 L -25.464 45.859 C -26.284 47.479 -26.754 49.299 -26.754 51.239 C -26.754 53.179 -26.284 54.999 -25.464 56.619 L -21.484 53.529 Z\"/>\r\n        <path fill=\"#EA4335\" d=\"M -14.754 43.989 C -12.984 43.989 -11.404 44.599 -10.154 45.789 L -6.734 42.369 C -8.804 40.429 -11.514 39.239 -14.754 39.239 C -19.444 39.239 -23.494 41.939 -25.464 45.859 L -21.484 48.949 C -20.534 46.099 -17.884 43.989 -14.754 43.989 Z\"/>\r\n      </g>\r\n    </SvgIcon>\r\n  );\r\n};\r\n\r\nexport default GoogleIcon;\r\n","import React, {\r\n  useRef,\r\n  useEffect,\r\n  useState\r\n} from 'react';\r\nimport {\r\n  Tooltip,\r\n  Typography\r\n} from '@material-ui/core';\r\nimport {\r\n  SystemStyleObject\r\n} from '@material-ui/system'\r\n\r\ninterface TitleTooltipProps {\r\n  text: string;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst TitleTooltip: React.FC<TitleTooltipProps> = (props) => {\r\n  const {\r\n    text,\r\n    sx\r\n  } = props;\r\n\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const [ isOverflow, setOverflow ] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const div = ref.current;\r\n    const check = () => {\r\n      if (div) {\r\n        const isOverflow = div.scrollWidth > div.offsetWidth;\r\n        setOverflow(isOverflow);\r\n      }\r\n    };\r\n    if (div && text) {\r\n      check();\r\n    } else {\r\n      setOverflow(false);\r\n    }\r\n  }, [\r\n    text\r\n  ]);\r\n\r\n  return (\r\n    <Tooltip\r\n      title={text}\r\n      disableHoverListener={!isOverflow}\r\n    >\r\n      <Typography\r\n        variant='h6'\r\n        component='div'\r\n        noWrap\r\n        sx={sx}\r\n        ref={ref}\r\n      >\r\n        <span>\r\n          {text}\r\n        </span>\r\n      </Typography>\r\n    </Tooltip>\r\n  );\r\n};\r\n\r\nexport default TitleTooltip;","import React, {\r\n  useState,\r\n  useRef,\r\n  useCallback,\r\n} from 'react';\r\nimport {\r\n  Box,\r\n  Toolbar,\r\n  Typography,\r\n  IconButton,\r\n  Menu,\r\n  MenuItem,\r\n  ToggleButtonGroup,\r\n  Tooltip,\r\n  ToggleButton,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  Avatar,\r\n  Divider,\r\n} from '@material-ui/core';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport FitBestIcon from '@material-ui/icons/CropDin';\r\nimport FitWidthIcon from '@material-ui/icons/CropPortrait';\r\nimport FitHeightIcon from '@material-ui/icons/CropLandscape';\r\nimport FitOriginalIcon from '@material-ui/icons/CropOriginal';\r\nimport FitManualIcon from '@material-ui/icons/ImageSearch';\r\nimport FullscreenEnterIcon from '@material-ui/icons/Fullscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport FirstImageIcon from '@material-ui/icons/FirstPage';\r\nimport LastImageIcon from '@material-ui/icons/LastPage';\r\nimport PrevImageIcon from '@material-ui/icons/NavigateBefore';\r\nimport NextImageIcon from '@material-ui/icons/NavigateNext';\r\nimport StartSlideshowIcon from '@material-ui/icons/PlayArrow';\r\nimport EndSlideshowIcon from '@material-ui/icons/Pause';\r\nimport OpenFileIcon from '@material-ui/icons/InsertDriveFile';\r\nimport RecentFilesIcon from '@material-ui/icons/History';\r\nimport DownloadFileIcon from '@material-ui/icons/FileDownload';\r\nimport CloseFileIcon from '@material-ui/icons/Close';\r\nimport HelpIcon from '@material-ui/icons/HelpOutline';\r\nimport AboutIcon from '@material-ui/icons/Info';\r\nimport PolicyIcon from '@material-ui/icons/Policy';\r\nimport TermsIcon from '@material-ui/icons/Gavel';\r\nimport SignOutIcon from '@material-ui/icons/Logout';\r\nimport GoogleIcon from './GoogleIcon';\r\nimport CookiesErrorIcon from '@material-ui/icons/VisibilityOff';\r\nimport HideDrawerIcon from '@material-ui/icons/ArrowLeft';\r\nimport ShowDrawerIcon from '@material-ui/icons/ArrowRight';\r\nimport { defaultTitle, FitMode } from '../..';\r\nimport {\r\n  RecentFile,\r\n  useFullScreen,\r\n  useIsSignedIn,\r\n} from '../../../../lib/hooks';\r\nimport {\r\n  pickFile\r\n} from '../../../../lib/api';\r\nimport TitleTooltip from './TitleTooltip';\r\nimport { Link } from 'react-router-dom';\r\nimport CloseViewIcon from '@material-ui/icons/CancelPresentation';\r\n\r\ninterface TopbarProps {\r\n  title: string;\r\n  counterTitle: string;\r\n  fitMode: FitMode;\r\n  onFitModeChange: (fitMode: FitMode) => void;\r\n  onOpenFile: (file: google.picker.DocumentObject) => void;\r\n  onRecentFile: (file: RecentFile) => void;\r\n  fullscreenButtonActive?: boolean;\r\n  onToggleFullscreen: () => void;\r\n  isFirstImageEnabled?: boolean;\r\n  isPrevImageEnabled?: boolean;\r\n  isNextImageEnabled?: boolean;\r\n  isLastImageEnabled?: boolean;\r\n  isSlideshowEnabled?: boolean;\r\n  isSlideshowPlaying?: boolean;\r\n  onToggleSlideshowPlaying: () => void;\r\n  onFirstImage: () => void;\r\n  onPrevImage: () => void;\r\n  onNextImage: () => void;\r\n  onLastImage: () => void;\r\n  recentFiles: RecentFile[];\r\n  onDownloadFile: () => void;\r\n  onCloseFile: () => void;\r\n  onSignOut: () => void;\r\n  isMobileDrawerOpen: boolean;\r\n  toggleMobileDrawer: () => void;\r\n};\r\n\r\nconst Topbar: React.FC<TopbarProps> = (props) => {\r\n  const {\r\n    title,\r\n    counterTitle,\r\n    fitMode,\r\n    onFitModeChange,\r\n    onOpenFile,\r\n    onRecentFile,\r\n    fullscreenButtonActive,\r\n    onToggleFullscreen,\r\n    isFirstImageEnabled,\r\n    isPrevImageEnabled,\r\n    isNextImageEnabled,\r\n    isLastImageEnabled,\r\n    isSlideshowEnabled,\r\n    isSlideshowPlaying,\r\n    onToggleSlideshowPlaying,\r\n    onFirstImage,\r\n    onPrevImage,\r\n    onNextImage,\r\n    onLastImage,\r\n    recentFiles,\r\n    onDownloadFile,\r\n    onCloseFile,\r\n    onSignOut,\r\n    isMobileDrawerOpen,\r\n    toggleMobileDrawer\r\n  } = props;\r\n  const [ isMenuOpen, setMenuOpen ] = useState(false);\r\n  const menuRef = useRef<HTMLButtonElement>(null);\r\n  const [ isRecentMenuOpen, setRecentMenuOpen ] = useState(false);\r\n  const recentMenuRef = useRef<HTMLLIElement>(null);\r\n  const [ isHelpMenuOpen, setHelpMenuOpen ] = useState(false);\r\n  const helpMenuRef = useRef<HTMLButtonElement>(null);\r\n  const [ isProfileMenuOpen, setProfileMenuOpen ] = useState(false);\r\n  const profileMenuRef = useRef<HTMLButtonElement>(null);\r\n  const {\r\n    isEnabled: isFullscreenEnabled,\r\n    isFullscreen\r\n  } = useFullScreen();\r\n\r\n  const {\r\n    isSignedIn,\r\n    toggleSignedIn,\r\n    profile,\r\n    isCookiesError\r\n  } = useIsSignedIn(onSignOut);\r\n\r\n  const handleMenuClose = useCallback(() => {\r\n    setMenuOpen(false);\r\n  }, []);\r\n  const handleMenuClick = useCallback(() => {\r\n    setMenuOpen(current => !current);\r\n  }, []);\r\n  const onOpenClick = useCallback(async () => {\r\n    handleMenuClose();\r\n    try {\r\n      const doc = await pickFile();\r\n      if (doc) {\r\n        onOpenFile(doc);\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.log(err);\r\n    }\r\n  }, [\r\n    handleMenuClose,\r\n    onOpenFile\r\n  ]);\r\n  const onDrawerClick = useCallback(() => {\r\n    toggleMobileDrawer();\r\n    handleMenuClose();\r\n  }, [\r\n    toggleMobileDrawer,\r\n    handleMenuClose\r\n  ]);\r\n  const onDownloadClick = useCallback(() => {\r\n    onDownloadFile();\r\n    handleMenuClose();\r\n  }, [\r\n    handleMenuClose,\r\n    onDownloadFile\r\n  ]);\r\n  const onCloseClick = useCallback(() => {\r\n    onCloseFile();\r\n    handleMenuClose();\r\n  }, [\r\n    onCloseFile,\r\n    handleMenuClose\r\n  ]);\r\n  const handleRecentMenuClose = useCallback(() => {\r\n    setRecentMenuOpen(false);\r\n  }, []);\r\n  const handleRecentMenuClick = useCallback(() => {\r\n    setRecentMenuOpen(current => !current);\r\n  }, []);\r\n  const onRecentFileClick = useCallback((recentFile: RecentFile) => {\r\n    handleRecentMenuClose();\r\n    handleMenuClose();\r\n    onRecentFile(recentFile);\r\n  }, [\r\n    handleRecentMenuClose,\r\n    handleMenuClose,\r\n    onRecentFile\r\n  ]);\r\n  const handleHelpMenuClose = useCallback(() => {\r\n    setHelpMenuOpen(false);\r\n  }, []);\r\n  const handleHelpMenuClick = useCallback(() => {\r\n    setHelpMenuOpen(current => !current);\r\n  }, []);\r\n  const handleProfileMenuClose = useCallback(() => {\r\n    setProfileMenuOpen(false);\r\n  }, []);\r\n  const handleProfileMenuClick = useCallback(() => {\r\n    setProfileMenuOpen(current => !current);\r\n  }, []);\r\n  const onSignOutClick = useCallback(() => {\r\n    handleProfileMenuClose();\r\n    toggleSignedIn();\r\n  }, [\r\n    handleProfileMenuClose,\r\n    toggleSignedIn\r\n  ]);\r\n\r\n  return (\r\n    <Toolbar>\r\n      <IconButton\r\n        size='large'\r\n        edge='start'\r\n        color='inherit'\r\n        aria-label='menu'\r\n        sx={{ mr: 2 }}\r\n        ref={menuRef}\r\n        onClick={handleMenuClick}\r\n      >\r\n        <MenuIcon />\r\n      </IconButton>\r\n      <Menu\r\n        anchorEl={menuRef.current}\r\n        open={isMenuOpen}\r\n        onClose={handleMenuClose}\r\n      >\r\n        <MenuItem\r\n          onClick={onDrawerClick}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            {isMobileDrawerOpen ?\r\n              <HideDrawerIcon/> :\r\n              <ShowDrawerIcon/>\r\n            }\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {isMobileDrawerOpen ?\r\n              'Hide Thumbnails' :\r\n              'Show Thumbnails'\r\n            }\r\n          </ListItemText>\r\n        </MenuItem>\r\n        {!isSignedIn &&\r\n          <MenuItem\r\n            onClick={toggleSignedIn}\r\n          >\r\n            <ListItemIcon>\r\n              <GoogleIcon/>\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {'Sign in with Google'}\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        {isSignedIn &&\r\n          <MenuItem\r\n            onClick={onOpenClick}\r\n          >\r\n            <ListItemIcon>\r\n              <OpenFileIcon/>\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {'Open File'}\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        {isSignedIn &&\r\n          <MenuItem\r\n            onClick={handleRecentMenuClick}\r\n            disabled={recentFiles.length === 0}\r\n            ref={recentMenuRef}\r\n          >\r\n            <ListItemIcon>\r\n              <RecentFilesIcon/>\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {'Recent Files'}\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        {fullscreenButtonActive &&\r\n          <MenuItem\r\n            onClick={onDownloadClick}\r\n          >\r\n            <ListItemIcon>\r\n              <DownloadFileIcon/>\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {'Download File'}\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        {fullscreenButtonActive &&\r\n          <MenuItem\r\n            onClick={onCloseClick}\r\n          >\r\n            <ListItemIcon>\r\n              <CloseFileIcon/>\r\n            </ListItemIcon>\r\n            <ListItemText>\r\n              {'Close File'}\r\n            </ListItemText>\r\n          </MenuItem>\r\n        }\r\n        <Divider\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        />\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onFirstImage();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FirstImageIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'First Image'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onPrevImage();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <PrevImageIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Previous Image'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onToggleSlideshowPlaying();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            {isSlideshowPlaying ?\r\n              <EndSlideshowIcon/> :\r\n              <StartSlideshowIcon/>\r\n            }\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {isSlideshowPlaying ?\r\n              'End Slideshow' :\r\n              'Start Slideshow'\r\n            }\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onNextImage();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <NextImageIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Next Image'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onLastImage();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <LastImageIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Last Image'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <Divider\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        />\r\n        <MenuItem\r\n          onClick={() => {\r\n            onFitModeChange(FitMode.Best);\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' },\r\n            backgroundColor: fitMode === FitMode.Best ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitBestIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Best Fit'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={() => {\r\n            onFitModeChange(FitMode.Width);\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' },\r\n            backgroundColor: fitMode === FitMode.Width ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitWidthIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Fit Width'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={() => {\r\n            onFitModeChange(FitMode.Height);\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' },\r\n            backgroundColor: fitMode === FitMode.Height ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitHeightIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Fit Height'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={() => {\r\n            onFitModeChange(FitMode.Original);\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' },\r\n            backgroundColor: fitMode === FitMode.Original ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitOriginalIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Original Size'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          onClick={() => {\r\n            onFitModeChange(FitMode.Manual);\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' },\r\n            backgroundColor: fitMode === FitMode.Manual ?\r\n              'rgba(0, 0, 0, 0.08)' : undefined\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <FitManualIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Manual Zoom'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <Divider\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        />\r\n        <MenuItem\r\n          disabled={!fullscreenButtonActive}\r\n          onClick={() => {\r\n            onToggleFullscreen();\r\n            handleMenuClose();\r\n          }}\r\n          sx={{\r\n            display: { xs: 'flex', md: 'none' }\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            {isFullscreen ?\r\n              <FullscreenExitIcon /> :\r\n              <FullscreenEnterIcon/>\r\n            }\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {isFullscreen ?\r\n              'Exit Fullscreen' :\r\n              'Enter Fullscreen'\r\n            }\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component={Link}\r\n          to={'/'}\r\n          onClick={() => {\r\n            document.title = defaultTitle;\r\n          }}\r\n        >\r\n          <ListItemIcon>\r\n            <CloseViewIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Close View'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n      <Menu\r\n        anchorEl={recentMenuRef.current}\r\n        open={isRecentMenuOpen}\r\n        onClose={handleRecentMenuClose}\r\n        PaperProps={{\r\n          sx: {\r\n            maxWidth: '400px'\r\n          }\r\n        }}\r\n        anchorOrigin={{\r\n          vertical: 'top',\r\n          horizontal: 'right'\r\n        }}\r\n      >\r\n        {recentFiles.map((recentFile, i) => (\r\n          <MenuItem\r\n            key={i}\r\n            onClick={() => onRecentFileClick(recentFile)}\r\n          >\r\n            <Typography\r\n              noWrap\r\n            >\r\n              {recentFile.title}\r\n            </Typography>\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n      <TitleTooltip\r\n        text={title}\r\n        sx={{\r\n          flexGrow: 1\r\n        }}\r\n      />\r\n      {!!counterTitle &&\r\n        <Box\r\n          sx={{\r\n            m: 1\r\n          }}\r\n        >\r\n          <Typography variant='body1' noWrap>\r\n            {counterTitle}\r\n          </Typography>\r\n        </Box>\r\n      }\r\n      <Tooltip\r\n        title='First Image (Home)'\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: { xs: 'none', md: 'block' }\r\n          }}\r\n        >\r\n          <IconButton\r\n            size='large'\r\n            color='inherit'\r\n            aria-label='first-image'\r\n            disabled={!isFirstImageEnabled}\r\n            onClick={onFirstImage}\r\n          >\r\n            <FirstImageIcon/>\r\n          </IconButton>\r\n        </Box>\r\n      </Tooltip>\r\n      <Tooltip\r\n        title='Previous Image (Left Arrow)'\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: { xs: 'none', md: 'block' }\r\n          }}\r\n        >\r\n          <IconButton\r\n            size='large'\r\n            color='inherit'\r\n            aria-label='prev-image'\r\n            disabled={!isPrevImageEnabled}\r\n            onClick={onPrevImage}\r\n            sx={{\r\n              p: { xs: '6px', md: '12px'}\r\n            }}\r\n          >\r\n            <PrevImageIcon/>\r\n          </IconButton>\r\n        </Box>\r\n      </Tooltip>\r\n      <Tooltip\r\n        title={isSlideshowPlaying ?\r\n          'End Slideshow (Space)' :\r\n          'Start Slideshow (Space)'\r\n        }\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: { xs: 'none', md: 'block' }\r\n          }}\r\n        >\r\n          <IconButton\r\n            size='large'\r\n            color='inherit'\r\n            aria-label='next-image'\r\n            disabled={!isSlideshowEnabled}\r\n            onClick={onToggleSlideshowPlaying}\r\n          >\r\n            {isSlideshowPlaying ?\r\n              <EndSlideshowIcon/> :\r\n              <StartSlideshowIcon/>\r\n            }\r\n          </IconButton>\r\n        </Box>\r\n      </Tooltip>\r\n      <Tooltip\r\n        title='Next Image (Right Arrow, Scroll Below, Click)'\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: { xs: 'none', md: 'block' }\r\n          }}\r\n        >\r\n          <IconButton\r\n            size='large'\r\n            color='inherit'\r\n            aria-label='next-image'\r\n            disabled={!isNextImageEnabled}\r\n            onClick={onNextImage}\r\n            sx={{\r\n              p: { xs: '6px', md: '12px'}\r\n            }}\r\n          >\r\n            <NextImageIcon/>\r\n          </IconButton>\r\n        </Box>\r\n      </Tooltip>\r\n      <Tooltip\r\n        title='Last Image (End)'\r\n      >\r\n        <Box\r\n          sx={{\r\n            display: { xs: 'none', md: 'block' }\r\n          }}\r\n        >\r\n          <IconButton\r\n            size='large'\r\n            color='inherit'\r\n            aria-label='last-image'\r\n            disabled={!isLastImageEnabled}\r\n            onClick={onLastImage}\r\n          >\r\n            <LastImageIcon/>\r\n          </IconButton>\r\n        </Box>\r\n      </Tooltip>\r\n      <ToggleButtonGroup\r\n        value={fitMode}\r\n        exclusive\r\n        onChange={(e, value) => {\r\n          if (value) {\r\n            onFitModeChange(value)\r\n          }\r\n        }\r\n        }\r\n        sx={{\r\n          display: { xs: 'none', sm: 'flex' },\r\n        }}\r\n      >\r\n        <ToggleButton\r\n          value={FitMode.Best}\r\n          aria-label='best-fit'\r\n          sx={{\r\n            p: 0,\r\n            display: { xs: 'none', sm: 'block' },\r\n          }}\r\n        >\r\n          <Tooltip\r\n            title='Best Fit'\r\n          >\r\n            <Box\r\n              sx={{\r\n                height: 'min-content',\r\n                width: 'min-content',\r\n                p: '11px',\r\n                display: 'grid',\r\n                alignContent: 'center',\r\n                justifyContent: 'center'\r\n              }}\r\n            >\r\n              <FitBestIcon/>\r\n            </Box>\r\n          </Tooltip>\r\n        </ToggleButton>\r\n        <ToggleButton\r\n          value={FitMode.Width}\r\n          aria-label='fit-width'\r\n          sx={{\r\n            p: 0,\r\n            display: { xs: 'none', sm: 'block' },\r\n          }}\r\n        >\r\n          <Tooltip\r\n            title='Fit Width'\r\n          >\r\n            <Box\r\n              sx={{\r\n                height: 'min-content',\r\n                width: 'min-content',\r\n                p: '11px',\r\n                display: 'grid',\r\n                alignContent: 'center',\r\n                justifyContent: 'center'\r\n              }}\r\n            >\r\n              <FitWidthIcon/>\r\n            </Box>\r\n          </Tooltip>\r\n        </ToggleButton>\r\n        <ToggleButton\r\n          value={FitMode.Height}\r\n          aria-label='fit-height'\r\n          sx={{\r\n            p: 0,\r\n            display: { xs: 'none', md: 'block' },\r\n          }}\r\n        >\r\n          <Tooltip\r\n            title='Fit Height'\r\n          >\r\n            <Box\r\n              sx={{\r\n                height: 'min-content',\r\n                width: 'min-content',\r\n                p: '11px',\r\n                display: 'grid',\r\n                alignContent: 'center',\r\n                justifyContent: 'center'\r\n              }}\r\n            >\r\n              <FitHeightIcon/>\r\n            </Box>\r\n          </Tooltip>\r\n        </ToggleButton>\r\n        <ToggleButton\r\n          value={FitMode.Original}\r\n          aria-label='fit-original'\r\n          sx={{\r\n            p: 0,\r\n            display: { xs: 'none', md: 'block' },\r\n          }}\r\n        >\r\n          <Tooltip\r\n            title='Original Size'\r\n          >\r\n            <Box\r\n              sx={{\r\n                height: 'min-content',\r\n                width: 'min-content',\r\n                p: '11px',\r\n                display: 'grid',\r\n                alignContent: 'center',\r\n                justifyContent: 'center'\r\n              }}\r\n            >\r\n              <FitOriginalIcon/>\r\n            </Box>\r\n          </Tooltip>\r\n        </ToggleButton>\r\n        <ToggleButton\r\n          value={FitMode.Manual}\r\n          aria-label='fit-manual'\r\n          sx={{\r\n            p: 0,\r\n            display: { xs: 'none', md: 'block' },\r\n          }}\r\n        >\r\n          <Tooltip\r\n            title='Manual Zoom'\r\n          >\r\n            <Box\r\n              sx={{\r\n                height: 'min-content',\r\n                width: 'min-content',\r\n                p: '11px',\r\n                display: 'grid',\r\n                alignContent: 'center',\r\n                justifyContent: 'center'\r\n              }}\r\n            >\r\n              <FitManualIcon/>\r\n            </Box>\r\n          </Tooltip>\r\n        </ToggleButton>\r\n      </ToggleButtonGroup>\r\n      {isFullscreenEnabled &&\r\n        <Tooltip\r\n          title={isFullscreen ?\r\n            'Exit Fullscreen' :\r\n            'Enter Fullscreen'\r\n          }\r\n        >\r\n          <Box>\r\n            <IconButton\r\n              size='large'\r\n              color='inherit'\r\n              aria-label='fullscreen'\r\n              disabled={!fullscreenButtonActive}\r\n              onClick={onToggleFullscreen}\r\n            >\r\n              {isFullscreen ?\r\n                <FullscreenExitIcon /> :\r\n                <FullscreenEnterIcon/>\r\n              }\r\n            </IconButton>\r\n          </Box>\r\n        </Tooltip>\r\n      }\r\n      <Tooltip\r\n        title='Terms And Conditions'\r\n      >\r\n        <IconButton\r\n          size='large'\r\n          color='inherit'\r\n          aria-label='terms-and-policy'\r\n          edge={isSignedIn ? undefined : 'end'}\r\n          ref={helpMenuRef}\r\n          onClick={handleHelpMenuClick}\r\n          sx={{\r\n            p: { xs: '6px', md: '12px'}\r\n          }}\r\n        >\r\n          <HelpIcon/>\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Menu\r\n        anchorEl={helpMenuRef.current}\r\n        open={isHelpMenuOpen}\r\n        onClose={handleHelpMenuClose}\r\n        MenuListProps={{\r\n          'aria-labelledby': 'basic-button',\r\n        }}\r\n      >\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/about.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <AboutIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'About'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/privacy.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <PolicyIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Privacy Policy'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n        <MenuItem\r\n          component='a'\r\n          href={`${process.env.PUBLIC_URL}/terms.html`}\r\n        >\r\n          <ListItemIcon>\r\n            <TermsIcon/>\r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Terms And Conditions'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n      {isSignedIn && profile &&\r\n        <IconButton\r\n          size='large'\r\n          edge='end'\r\n          color='inherit'\r\n          aria-label='terms-and-policy'\r\n          ref={profileMenuRef}\r\n          onClick={handleProfileMenuClick}\r\n          sx={{\r\n            p: '6px'\r\n          }}\r\n        >\r\n          <Avatar\r\n            src={profile.imageUrl}\r\n            sx={{\r\n              width: 32,\r\n              height: 32\r\n            }}\r\n          />\r\n        </IconButton>\r\n      }\r\n      <Menu\r\n        anchorEl={profileMenuRef.current}\r\n        open={isProfileMenuOpen}\r\n        onClose={handleProfileMenuClose}\r\n        MenuListProps={{\r\n          'aria-labelledby': 'basic-button',\r\n        }}\r\n      >\r\n        <MenuItem\r\n          onClick={onSignOutClick}\r\n        >\r\n          <ListItemIcon>\r\n            <SignOutIcon/> \r\n          </ListItemIcon>\r\n          <ListItemText>\r\n            {'Sign Out'}\r\n          </ListItemText>\r\n        </MenuItem>\r\n      </Menu>\r\n      {!isSignedIn && isCookiesError &&\r\n        <Tooltip\r\n          title={`You need to enable 3rd party cookies.\r\n            Click \"eye\" icon at the end of address bar`}\r\n        >\r\n          <CookiesErrorIcon\r\n            color='error'\r\n            sx={{\r\n              ml: '12px',\r\n              mr: '-6px'\r\n            }}\r\n          />\r\n        </Tooltip>\r\n      }\r\n    </Toolbar>\r\n  );\r\n};\r\n\r\nexport default Topbar;","import React, {\r\n  useCallback,\r\n} from 'react';\r\nimport {\r\n  SystemStyleObject,\r\n} from '@material-ui/system';\r\nimport {\r\n  Box,\r\n  Button,\r\n} from '@material-ui/core';\r\nimport OpenFileIcon from '@material-ui/icons/InsertDriveFile';\r\nimport { useIsSignedIn } from '../../../../lib/hooks';\r\nimport { pickFile } from '../../../../lib/api';\r\nimport GoogleIcon from '../topbar/GoogleIcon';\r\n\r\ninterface StartScreenProps {\r\n  onOpenFile: (file: google.picker.DocumentObject) => void;\r\n  sx?: SystemStyleObject;\r\n};\r\n\r\nconst StartScreen: React.FC<StartScreenProps> = (props) => {\r\n  const {\r\n    onOpenFile,\r\n    sx\r\n  } = props;\r\n\r\n  const {\r\n    isSignedIn,\r\n    toggleSignedIn\r\n  } = useIsSignedIn();\r\n\r\n  const onOpenClick = useCallback(async () => {\r\n    try {\r\n      const doc = await pickFile();\r\n      if (doc) {\r\n        onOpenFile(doc);\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.log(err);\r\n    }\r\n  }, [\r\n    onOpenFile\r\n  ]);\r\n\r\n  return (\r\n    <Box sx={{\r\n      ...sx,\r\n      display: 'grid',\r\n      justifyContent: 'center',\r\n      alignContent: 'center',\r\n    }}>\r\n      {isSignedIn ?\r\n        <Button\r\n          onClick={onOpenClick}\r\n          variant={'contained'}\r\n          color='secondary'\r\n          startIcon={<OpenFileIcon/>}\r\n        >\r\n          {'Open File'}\r\n        </Button> :\r\n        <Button\r\n          onClick={toggleSignedIn}\r\n          variant={'contained'}\r\n          color='secondary'\r\n          startIcon={\r\n            <Box\r\n              sx={{\r\n                bgcolor: 'white',\r\n                height: '44px',\r\n                width: '44px',\r\n                display: 'grid',\r\n                justifyContent: 'center',\r\n                alignContent: 'center',\r\n              }}\r\n            >\r\n              <GoogleIcon/>\r\n            </Box>\r\n          }\r\n          sx={{\r\n            textTransform: 'none',\r\n            padding: '1px 8px 1px 5px',\r\n            borderRadius: '2px',\r\n            overflow: 'hidden'\r\n          }}\r\n        >\r\n          {'Sign in with Google'}\r\n        </Button>\r\n      }\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default StartScreen;","import React from 'react';\r\nimport Home from './containers/home';\r\nimport View from './containers/view';\r\nimport {\r\n  BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from 'react-router-dom';\r\n\r\nconst App: React.FC = () => {\r\n  return (\r\n    <Router>\r\n      <Switch>\r\n        <Route path='/view'>\r\n          <View />\r\n        </Route>\r\n        <Route path='/'>\r\n          <Home />\r\n        </Route>\r\n      </Switch>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { createTheme } from '@material-ui/core/styles';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#ffffff',\r\n      contrastText: '#595959'\r\n    },\r\n    secondary: {\r\n      main: '#3476dd',\r\n      contrastText: '#ffffff'\r\n    }\r\n  },\r\n  components: {\r\n    MuiTooltip: {\r\n      styleOverrides: {\r\n        tooltip: {\r\n          backgroundColor: 'rgba(0, 0, 0, 0.5)'\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nexport default theme;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport { ThemeProvider } from '@material-ui/core/styles';\r\nimport theme from './theme';\r\n\r\nReactDOM.render(\r\n  <ThemeProvider theme={theme}>\r\n    <React.StrictMode>\r\n      <CssBaseline />\r\n      <App />\r\n    </React.StrictMode>\r\n  </ThemeProvider>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}